var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,f,e){c instanceof String&&(c=String(c));for(var k=c.length,g=0;g<k;g++){var r=c[g];if(f.call(e,r,g,c))return{i:g,v:r}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,f,e){c!=Array.prototype&&c!=Object.prototype&&(c[f]=e.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,f,e,k){if(f){e=$jscomp.global;c=c.split(".");for(k=0;k<c.length-1;k++){var g=c[k];g in e||(e[g]={});e=e[g]}c=c[c.length-1];k=e[c];f=f(k);f!=k&&null!=f&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6","es3");
$(function(){function c(b){var a=document.getElementById("body");b.dialog("option","width",.8*a.clientWidth);b.dialog("option","height",.8*window.innerHeight)}function f(b){var a=t(!0);null!==a&&a.dialog("option","title",b);B.text(b)}function e(b,a,h){var c=getRelativeRootPath()+"ci/"+projectData.path.join("/")+"/"+PoggitConsts.BuildClass[b].toLowerCase()+":"+a;h||history.pushState(null,"",c);document.title=PoggitConsts.BuildClass[b]+" Build #"+a+" @ "+projectData.path[2]+" ("+projectData.path[0]+
"/"+projectData.path[1]+")";f(PoggitConsts.BuildClass[b]+" Build #"+a);v=!0;w?n.showNarrow():n.showWide();var d=Math.random();C=d;l.find(".ci-build-loading").css("display","block");l.find(".ci-build-section-content").css("display","none");h=null;for(var e in p)if(c=p[e],c.internal===a&&c.class===b&&"undefined"!==typeof c.statuses){h=c;break}null!==h&&void 0!==h.statuses?k(h):ajax("ci.build.request",{data:{projectId:projectData.project.projectId,"class":b,internal:a},success:function(a){p[a.buildId]=
a;C===d&&(k(a),D(a))},error:function(){alert(projectData.project.projectName+" "+PoggitConsts.BuildClass[b]+"#"+a+" does not exist!")}})}function k(b){l.find(".ci-build-loading").css("display","none");l.find("#ci-build-sha").text(b.sha);l.find(".ci-build-commit-message").attr("data-sha",b.sha).empty();void 0!==b.commitMessage&&E(b.sha,b.commitMessage,b.authorName,b.authorLogin);var a=l.find("#ci-build-virion");a.empty();var h=!0;for(d in b.virions)if(b.virions.hasOwnProperty(d)){var c=b.virions[d];
a.append($("<li></li>").append($("<a></a>").attr("href","/babs/"+c.babs).text(d+" v"+c.version+" ("+c.branch+"@"+c.sha.substr(0,7)+")")));h&&(l.find(".ci-build-virion-section").css("display","block"),h=!1)}a=l.find("#ci-build-lint");a.empty();if(0===b.statuses.length)a.append("<h6>No problems have been found. Well done!</h6>");else for(h=0;h<b.statuses.length;++h){var d=b.statuses[h];$("<div class='ci-build-lint-info'></div>").attr("data-class",d.class).append($("<p class='remark'></p>").text("Severity: "+
PoggitConsts.LintLevel[d.level])).append($("<div class='ci-build-lint-details'></div>").html(d.html)).appendTo(a)}l.find(".ci-build-section-content").css("display","block")}function g(b){document.title=projectData.path[2]+" ("+projectData.path[0]+"/"+projectData.path[1]+")";b&&history.pushState(null,"",getRelativeRootPath()+"ci/"+projectData.path.join("/"));v=!1;w?n.hideNarrow():n.hideWide()}function r(b){var a=location.pathname.substring(getRelativeRootPath().length).split(/\//);if(5<=a.length&&
(a=/^(?:(dev|pr):)?(\d+)$/i.exec(a[4]),null!==a)){b=1;"undefined"!==typeof a[1]&&(b="pr"===a[1]?4:1);e(b,Number(a[2]),!0);return}b&&g(!1)}function x(b,a,c,m){a={projectId:projectData.project.projectId,branch:b,lt:a,count:c};m&&(a.pr="");ajax("build.history.new",{data:a,success:function(a){var h=$("#ci-project-history-table"),d,e=-1;for(d=0;d<a.length;++d)"undefined"===typeof p[a[d].buildId]&&(p[a[d].buildId]=a[d]),e=a[d].internal;for(d=0;d<a.length;++d)h.append(F(a[d].buildId));q={branch:b,tail:e,
size:(null===q?0:q.size)+c,pr:m};$(".ci-project-history-locks").removeClass("disabled").prop("disabled",!1)}})}function F(b){var a=p[b];if("undefined"!==typeof a.$row)return a.$row;var c=$("<tr class='ci-project-history-content-row'></tr>"),m=null,d=null,g=null;null!==projectData.release&&b===projectData.release.buildId&&(3<projectData.release.state||3===projectData.release.state&&isLoggedIn()||projectData.writePerm)&&(g=getRelativeRootPath()+"p/"+projectData.release.name+"/"+projectData.release.version);
null!==projectData.preRelease&&b===projectData.preRelease.buildId&&(3<projectData.preRelease.state||3===projectData.preRelease.state&&isLoggedIn()||projectData.writePerm)&&(d=getRelativeRootPath()+"p/"+projectData.preRelease.name+"/"+projectData.preRelease.version);projectData.writePerm&&(1===a.class&&1===projectData.project.projectType&&(null===projectData.release&&null===projectData.preRelease?m="Submit":b>(projectData.release?projectData.release.buildId:0)&&b>(projectData.preRelease?projectData.preRelease.buildId:
0)&&(m="Update")),null!==m?(b=$("<button class='btn action'>"+m+"</button>").click(function(){var b=m.toLowerCase();if("submit"===b||"update"===b)$("#wait-spinner").modal(),window.location=getRelativeRootPath()+b+"/"+projectData.path.join("/")+"/"+a.internal}),$("<td class='ci-project-history-action-cell'></td>").append(b).appendTo(c)):$("<td class='ci-project-history-action-cell' style='text-align: center;'></td>").append($("<span class='ci-project-history-action-cell-text text-danger hover-title' title='"+
(2===projectData.project.projectType?"Virion builds cannot be submitted.'>Unavailable</span>":"A newer build has already been submitted/updated.'>N/A</span>"))).appendTo(c));b=getRelativeRootPath()+"babs/"+a.buildId.toString(16);var f=function(){e(a.class,a.internal,!1);return!1};$("<td class='ci-project-history-build-number'></td>").append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text(PoggitConsts.BuildClass[a.class]+" #"+a.internal).attr("href",b).click(f)).append(g?" <a style='color: red;' href='"+
g+"'>[R]</a>":d?" <a style='color: red;' href='"+d+"'>[P]</a>":"")).append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text("(&"+a.buildId.toString(16)+")").attr("href",b).click(f))).appendTo(c);$("<td class='ci-project-history-date'></td>").append($("<span class='time-elapse' data-max-elapse='604800'></span>").attr("data-timestamp",a.date)).appendTo(c);d=PoggitConsts.LintLevel[a.worstLint];$("<td class='ci-project-history-lint'></td>").addClass("lint-style-"+d.toLowerCase().replace(" ",
"-")).append($("<p></p>").text(0===a.lintCount?"OK":a.lintCount+" problem"+(1!==a.lintCount?"s":"")).css("margin-bottom","0")).appendTo(c);$("<td class='ci-project-history-commit'></td>").hover(u(!0),u(!1)).append($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/commit/"+a.sha).append($("<code></code>").text(a.sha?a.sha.substring(0,7):"unknown"))).append($("<span></span>").addClass("ci-build-commit-message").attr("data-sha",a.sha)).appendTo(c);
d=$("<td class='ci-project-history-branch'></td>").appendTo(c);4===a.class?(d.text("#"+a.branch),d.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/pull/"+a.branch))):(d.text(a.branch),d.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/tree/"+a.branch+"/"+a.path)));d=getRelativeRootPath()+"r/"+a.resourceId+"/"+projectData.path[2]+"_"+PoggitConsts.BuildClass[a.class].toLowerCase()+
"-"+a.internal+".phar";$("<td class='ci-project-history-dl'></td>").append(1===a.resourceId?"N/A":$("<a></a>").text((Math.round(a.dlSize/102.4)/10).toString()+" KB").attr("href",d).click(function(){var b=confirm("This "+(2===projectData.project.projectType?"virion":"plugin")+" has not been reviewed, and it may contain dangerous code including viruses. Do you still want to download this file?");gaEventCi(!0,!b,projectData.project.projectName,a.resourceId,!1);return b})).appendTo(c);2===projectData.project.projectType&&
$("<td class='ci-project-history-virion-version'></td>").text(a.virionVersion).appendTo(c);D(a);return a.$row=c}function D(b){ghApi("repositories/"+projectData.project.repoId+"/commits/"+b.sha,{},"GET",function(a){b.commitMessage=a.commit?a.commit.message:"unknown";b.authorName=a.commit?a.commit.author.name:"unknown";b.authorLogin=a.commit?a.author.login:"unknown";E(a.sha,b.commitMessage,b.authorName,b.authorLogin)})}function E(b,a,c,e){$("span.ci-build-commit-message[data-sha='"+b+"']").each(function(){var b=
$(this);b.empty();b.text(a.split("\n")[0]);$("<span class='ci-build-commit-details'></span>").text(a.split("\n").slice(1).join("\n")).appendTo(b);$("<a target='_blank'></a>").attr("href","https://github.com/"+e).attr("title",c).append($("<img width='16'/>").attr("onerror","this.src='/res/ghMark.png'; this.onerror=null;").attr("src","https://github.com/"+e+".png?width=20").css("margin","5px")).prependTo(b)})}function u(b){return function(){$(this).find(".ci-build-commit-details").css("display",b?"block":
"none")}}var p={},q=null,l=$("#ci-build-inner"),y=$("#ci-build-pane");$("#ci-build-close").click(function(){g(!0)});var B=$("#ci-build-header"),v=!1,w,z=!1,C=null;l.find(".ci-build-commit-message").hover(u(!0),u(!1));var t=function(){var b;return function(a){if("undefined"!==typeof b)return b;if(a)return null;b=$("<div id='build-pane-dialog'></div>");b.dialog({autoOpen:!1,modal:!0,position:modalPosition,close:function(){z||g(!0)},open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#build-pane-dialog").dialog("close")})}});
return b}}(),n={showNarrow:function(){var b=t();b.dialog("option","title",B.text());l.appendTo(b);c(b);b.dialog("open")},hideNarrow:function(){var b=t();z=!0;b.dialog("close");z=!1},showWide:function(){l.appendTo(y);y.css("display","flex")},hideWide:function(){y.css("display","none")}};(function(){function b(a){w=a;v&&(a?(n.hideWide(),n.showNarrow()):(n.hideNarrow(),n.showWide()))}var a=window.matchMedia("(max-width: 1000px)");b(a.matches);a.addListener(function(a){b(a.matches)});$(window).resize(function(){var a=
t(!0);null!==a&&c(a)})})();window.addEventListener("popstate",function(){r(!0)});r(!1);var G=document.getElementById("projectPath"),A=/^https:\/\/github\.com\/([a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38})\/([a-z0-9_.-]+)\/tree\/master\/?(.*)/i.exec(G.href);ghApi("repos/"+A[1]+"/"+A[2],{},"GET",function(b){G.href="https://github.com/"+b.full_name+"/tree/"+b.default_branch+"/"+A[3]});var H=getParameterByName("branch","special:dev");$("#ci-project-history-branch-select").val(H);x(H,-1,10);$("#ci-project-history-load-more").click(function(){$(this).hasClass("disabled")||
($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),null!==q&&x(q.branch,q.tail,10,q.pr))});$("#ci-project-history-branch-select").change(function(){function b(a,b){return"special:dev"===b?!0:"special:pr"===b?4===a.class:b===a.branch}var a=$("#ci-project-history-table");a.find(".ci-project-history-content-row").detach();var c=this.value,e=Object.valuesToArray(p);e.sort(function(a,b){return b.date-a.date});for(var d=0,g=-1,f=0;f<e.length;++f)b(e[f],c)&&(a.append(F(e[f].buildId)),
++d,-1===g||g>e[f].internal)&&(g=e[f].internal);10>d&&($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),x(c,g,10-d,"special:pr"===c))})});
