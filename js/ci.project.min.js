var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,f,g){c instanceof String&&(c=String(c));for(var l=c.length,h=0;h<l;h++){var r=c[h];if(f.call(g,r,h,c))return{i:h,v:r}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,f,g){c!=Array.prototype&&c!=Object.prototype&&(c[f]=g.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,f,g,l){if(f){g=$jscomp.global;c=c.split(".");for(l=0;l<c.length-1;l++){var h=c[l];h in g||(g[h]={});g=g[h]}c=c[c.length-1];l=g[c];f=f(l);f!=l&&null!=f&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,g){return $jscomp.findInternal(this,c,g).v}},"es6","es3");
$(function(){function c(b){var a=document.getElementById("body");b.dialog("option","width",.8*a.clientWidth);b.dialog("option","height",.8*window.innerHeight)}function f(b){var a=t(!0);null!==a&&a.dialog("option","title",b);B.text(b)}function g(b,a,k){var d=getRelativeRootPath()+"ci/"+projectData.path.join("/")+"/"+PoggitConsts.BuildClass[b].toLowerCase()+":"+a;k||history.pushState(null,"",d);document.title=PoggitConsts.BuildClass[b]+" Build #"+a+" @ "+projectData.path[2]+" ("+projectData.path[0]+
"/"+projectData.path[1]+")";f(PoggitConsts.BuildClass[b]+" Build #"+a);v=!0;w?n.showNarrow():n.showWide();var e=Math.random();C=e;m.find(".ci-build-loading").css("display","block");m.find(".ci-build-section-content").css("display","none");k=null;for(var c in p)if(d=p[c],d.internal===a&&d.class===b&&"undefined"!==typeof d.statuses){k=d;break}null!==k&&void 0!==k.statuses?l(k):ajax("ci.build.request",{data:{projectId:projectData.project.projectId,"class":b,internal:a},success:function(a){p[a.buildId]=
a;C===e&&(l(a),D(a))},error:function(){alert(projectData.project.projectName+" "+PoggitConsts.BuildClass[b]+"#"+a+" does not exist!")}})}function l(b){m.find(".ci-build-loading").css("display","none");m.find("#ci-build-sha").text(b.sha);m.find(".ci-build-commit-message").attr("data-sha",b.sha).empty();void 0!==b.commitMessage&&E(b.sha,b.commitMessage,b.authorName,b.authorLogin);var a=m.find("#ci-build-virion");a.empty();var k=!0;for(e in b.virions)if(b.virions.hasOwnProperty(e)){var c=b.virions[e];
a.append($("<li></li>").append($("<a></a>").attr("href","/babs/"+c.babs).text(e+" v"+c.version+" ("+c.branch+"@"+c.sha.substr(0,7)+")")));k&&(m.find(".ci-build-virion-section").css("display","block"),k=!1)}a=m.find("#ci-build-lint");a.empty();if(0===b.statuses.length)a.append("<h6>No problems have been found. Well done!</h6>");else for(k=0;k<b.statuses.length;++k){var e=b.statuses[k];$("<div class='ci-build-lint-info'></div>").attr("data-class",e.class).append($("<p class='remark'></p>").text("Severity: "+
PoggitConsts.LintLevel[e.level])).append($("<div class='ci-build-lint-details'></div>").html(e.html)).appendTo(a)}m.find(".ci-build-section-content").css("display","block")}function h(b){document.title=projectData.path[2]+" ("+projectData.path[0]+"/"+projectData.path[1]+")";b&&history.pushState(null,"",getRelativeRootPath()+"ci/"+projectData.path.join("/"));v=!1;w?n.hideNarrow():n.hideWide()}function r(b){var a=location.pathname.substring(getRelativeRootPath().length).split(/\//);if(5<=a.length&&
(a=/^(?:(dev|pr):)?(\d+)$/i.exec(a[4]),null!==a)){b=1;"undefined"!==typeof a[1]&&(b="pr"===a[1]?4:1);g(b,Number(a[2]),!0);return}b&&h(!1)}function x(b,a,k,c){a={projectId:projectData.project.projectId,branch:b,lt:a,count:k};c&&(a.pr="");ajax("build.history.new",{data:a,success:function(a){var e=$("#ci-project-history-table"),d,g=-1;for(d=0;d<a.length;++d)"undefined"===typeof p[a[d].buildId]&&(p[a[d].buildId]=a[d]),g=a[d].internal;for(d=0;d<a.length;++d)e.append(F(a[d].buildId));q={branch:b,tail:g,
size:(null===q?0:q.size)+k,pr:c};$(".ci-project-history-locks").removeClass("disabled").prop("disabled",!1)}})}function F(b){var a=p[b];if("undefined"!==typeof a.$row)return a.$row;var c=$("<tr class='ci-project-history-content-row'></tr>"),d={},e=null,h=null;null!==projectData.release&&b===projectData.release.buildId&&(3<projectData.release.state||3===projectData.release.state&&isLoggedIn()||projectData.writePerm)&&(h=getRelativeRootPath()+"p/"+projectData.release.name+"/"+projectData.release.version);
null!==projectData.preRelease&&b===projectData.preRelease.buildId&&(3<projectData.preRelease.state||3===projectData.preRelease.state&&isLoggedIn()||projectData.writePerm)&&(e=getRelativeRootPath()+"p/"+projectData.preRelease.name+"/"+projectData.preRelease.version);if(projectData.writePerm){1===a.class&&1===projectData.project.projectType&&(null===projectData.release&&null===projectData.preRelease?d.submit="Submit":b>(projectData.release?projectData.release.buildId:0)&&b>(projectData.preRelease?projectData.preRelease.buildId:
0)&&(d.update="Update"));b=$("<select><option value='---' style='font-weight: bolder;'>Release...</option></select>").addClass("ci-project-history-action-select").change(function(){var b=this.value;if("submit"===b||"update"===b)$("#wait-spinner").modal(),window.location=getRelativeRootPath()+b+"/"+projectData.path.join("/")+"/"+a.internal;this.value="---"});for(var f in d)b.append($("<option></option>").attr("value",f).text(d[f]));$("<td class='ci-project-history-action-cell'></td>").append(b).appendTo(c)}d=
getRelativeRootPath()+"babs/"+a.buildId.toString(16);f=function(){g(a.class,a.internal,!1);return!1};$("<td class='ci-project-history-build-number'></td>").append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text(PoggitConsts.BuildClass[a.class]+" #"+a.internal).attr("href",d).click(f)).append(h?" <a style='color: red;' href='"+h+"'>[R]</a>":e?" <a style='color: red;' href='"+e+"'>[P]</a>":"")).append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text("(&"+a.buildId.toString(16)+
")").attr("href",d).click(f))).appendTo(c);$("<td class='ci-project-history-date'></td>").append($("<span class='time-elapse' data-max-elapse='604800'></span>").attr("data-timestamp",a.date)).appendTo(c);e=PoggitConsts.LintLevel[a.worstLint];$("<td class='ci-project-history-lint'></td>").addClass("lint-style-"+e.toLowerCase().replace(" ","-")).append($("<p></p>").text(0===a.lintCount?"OK":a.lintCount+" problem"+(1!==a.lintCount?"s":"")).css("margin-bottom","0")).appendTo(c);$("<td class='ci-project-history-commit'></td>").hover(u(!0),
u(!1)).append($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/commit/"+a.sha).append($("<code></code>").text(a.sha?a.sha.substring(0,7):"unknown"))).append($("<span></span>").addClass("ci-build-commit-message").attr("data-sha",a.sha)).appendTo(c);e=$("<td class='ci-project-history-branch'></td>").appendTo(c);4===a.class?(e.text("#"+a.branch),e.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+
projectData.path[1]+"/pull/"+a.branch))):(e.text(a.branch),e.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/tree/"+a.branch+"/"+a.path)));e=getRelativeRootPath()+"r/"+a.resourceId+"/"+projectData.path[2]+"_"+PoggitConsts.BuildClass[a.class].toLowerCase()+"-"+a.internal+".phar";$("<td class='ci-project-history-dl'></td>").append(1===a.resourceId?"N/A":$("<a></a>").text((Math.round(a.dlSize/102.4)/10).toString()+" KB").attr("href",
e).click(function(){var a=confirm("This "+(2===projectData.project.projectType?"virion":"plugin")+" has not been reviewed, and it may contain dangerous code including viruses. Do you still want to download this file?");ga("send","event",a?"Download":"Download.Cancel","CI (Project)",projectData.project.projectName);return a})).appendTo(c);2===projectData.project.projectType&&$("<td class='ci-project-history-virion-version'></td>").text(a.virionVersion).appendTo(c);D(a);return a.$row=c}function D(b){ghApi("repositories/"+
projectData.project.repoId+"/commits/"+b.sha,{},"GET",function(a){b.commitMessage=a.commit?a.commit.message:"unknown";b.authorName=a.commit?a.commit.author.name:"unknown";b.authorLogin=a.commit?a.author.login:"unknown";E(a.sha,b.commitMessage,b.authorName,b.authorLogin)})}function E(b,a,c,d){$("span.ci-build-commit-message[data-sha='"+b+"']").each(function(){var b=$(this);b.empty();b.text(a.split("\n")[0]);$("<span class='ci-build-commit-details'></span>").text(a.split("\n").slice(1).join("\n")).appendTo(b);
$("<a target='_blank'></a>").attr("href","https://github.com/"+d).attr("title",c).append($("<img width='16'/>").attr("src","https://github.com/"+d+".png?width=20").css("margin","5px")).prependTo(b)})}function u(b){return function(){$(this).find(".ci-build-commit-details").css("display",b?"block":"none")}}var p={},q=null,m=$("#ci-build-inner"),y=$("#ci-build-pane");$("#ci-build-close").click(function(){h(!0)});var B=$("#ci-build-header"),v=!1,w,z=!1,C=null;m.find(".ci-build-commit-message").hover(u(!0),
u(!1));var t=function(){var b;return function(a){if("undefined"!==typeof b)return b;if(a)return null;b=$("<div id='build-pane-dialog'></div>");b.dialog({autoOpen:!1,modal:!0,position:modalPosition,close:function(){z||h(!0)},open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#build-pane-dialog").dialog("close")})}});return b}}(),n={showNarrow:function(){var b=t();b.dialog("option","title",B.text());m.appendTo(b);c(b);b.dialog("open")},hideNarrow:function(){var b=t();z=!0;b.dialog("close");
z=!1},showWide:function(){m.appendTo(y);y.css("display","flex")},hideWide:function(){y.css("display","none")}};(function(){function b(a){w=a;v&&(a?(n.hideWide(),n.showNarrow()):(n.hideNarrow(),n.showWide()))}var a=window.matchMedia("(max-width: 1000px)");b(a.matches);a.addListener(function(a){b(a.matches)});$(window).resize(function(){var a=t(!0);null!==a&&c(a)})})();window.addEventListener("popstate",function(){r(!0)});r(!1);var G=document.getElementById("projectPath"),A=/^https:\/\/github\.com\/([a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38})\/([a-z0-9_.-]+)\/tree\/master\/?(.*)/i.exec(G.href);
ghApi("repos/"+A[1]+"/"+A[2],{},"GET",function(b){G.href="https://github.com/"+b.full_name+"/tree/"+b.default_branch+"/"+A[3]});var H=getParameterByName("branch","special:dev");$("#ci-project-history-branch-select").val(H);x(H,-1,10);$("#ci-project-history-load-more").click(function(){$(this).hasClass("disabled")||($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),null!==q&&x(q.branch,q.tail,10,q.pr))});$("#ci-project-history-branch-select").change(function(){function b(a,b){return"special:dev"===
b?!0:"special:pr"===b?4===a.class:b===a.branch}var a=$("#ci-project-history-table");a.find(".ci-project-history-content-row").detach();var c=this.value,d=Object.valuesToArray(p);d.sort(function(a,b){return b.date-a.date});for(var e=0,g=-1,f=0;f<d.length;++f)b(d[f],c)&&(a.append(F(d[f].buildId)),++e,-1===g||g>d[f].internal)&&(g=d[f].internal);10>e&&($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),x(c,g,10-e,"special:pr"===c))})});
