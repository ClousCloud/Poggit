var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,l,f){c instanceof String&&(c=String(c));for(var m=c.length,h=0;h<m;h++){var t=c[h];if(l.call(f,t,h,c))return{i:h,v:t}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,l,f){c!=Array.prototype&&c!=Object.prototype&&(c[l]=f.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,l,f,m){if(l){f=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var h=c[m];h in f||(f[h]={});f=f[h]}c=c[c.length-1];m=f[c];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6","es3");
$(function(){function c(b){var a=document.getElementById("body");b.dialog("option","width",.8*a.clientWidth);b.dialog("option","height",.8*window.innerHeight)}function l(b){var a=u(!0);null!==a&&a.dialog("option","title",b);C.text(b)}function f(b,a,k){var d=getRelativeRootPath()+"ci/"+projectData.path.join("/")+"/"+PoggitConsts.BuildClass[b].toLowerCase()+":"+a;k||history.pushState(null,"",d);document.title=PoggitConsts.BuildClass[b]+" Build #"+a+" @ "+projectData.path[2]+" ("+projectData.path[0]+
"/"+projectData.path[1]+")";l(PoggitConsts.BuildClass[b]+" Build #"+a);w=!0;x?p.showNarrow():p.showWide();var c=Math.random();D=c;n.find(".ci-build-loading").css("display","block");n.find(".ci-build-section-content").css("display","none");k=null;for(var f in q)if(d=q[f],d.internal===a&&d.class===b&&"undefined"!==typeof d.statuses){k=d;break}null!==k&&void 0!==k.statuses?m(k):ajax("ci.build.request",{data:{projectId:projectData.project.projectId,"class":b,internal:a},success:function(a){q[a.buildId]=
a;D===c&&(m(a),E(a))},error:function(){alert(projectData.project.projectName+" "+PoggitConsts.BuildClass[b]+"#"+a+" does not exist!")}})}function m(b){n.find(".ci-build-loading").css("display","none");n.find("#ci-build-sha").text(b.sha);n.find(".ci-build-commit-message").attr("data-sha",b.sha).empty();void 0!==b.commitMessage&&F(b.sha,b.commitMessage,b.authorName,b.authorLogin);var a=n.find("#ci-build-virion");a.empty();for(var k in b.virions)a.append($("<li></li>").text(k+" v"+b.virions[k]));a=n.find("#ci-build-lint");
a.empty();if(0===b.statuses.length)a.append("<h6>No problems have been found. Well done!</h6>");else for(k=0;k<b.statuses.length;++k){var c=b.statuses[k];$("<div class='ci-build-lint-info'></div>").attr("data-class",c.class).append($("<p class='remark'></p>").text("Severity: "+PoggitConsts.LintLevel[c.level])).append($("<div class='ci-build-lint-details'></div>").html(c.html)).appendTo(a)}n.find(".ci-build-section-content").css("display","block")}function h(b){document.title=projectData.path[2]+" ("+
projectData.path[0]+"/"+projectData.path[1]+")";b&&history.pushState(null,"",getRelativeRootPath()+"ci/"+projectData.path.join("/"));w=!1;x?p.hideNarrow():p.hideWide()}function t(b){var a=location.pathname.substring(getRelativeRootPath().length).split(/\//);if(5<=a.length&&(a=/^(?:(dev|pr):)?(\d+)$/i.exec(a[4]),null!==a)){b=1;"undefined"!==typeof a[1]&&(b="pr"===a[1]?4:1);f(b,Number(a[2]),!0);return}b&&h(!1)}function y(b,a,k,c){a={projectId:projectData.project.projectId,branch:b,lt:a,count:k};c&&
(a.pr="");ajax("build.history.new",{data:a,success:function(a){var d=$("#ci-project-history-table"),e,g=-1;for(e=0;e<a.length;++e)"undefined"===typeof q[a[e].buildId]&&(q[a[e].buildId]=a[e]),g=a[e].internal;for(e=0;e<a.length;++e)d.append(G(a[e].buildId));r={branch:b,tail:g,size:(null===r?0:r.size)+k,pr:c};$(".ci-project-history-locks").removeClass("disabled").prop("disabled",!1)}})}function G(b){var a=q[b];if("undefined"!==typeof a.$row)return a.$row;var c=$("<tr class='ci-project-history-content-row'></tr>"),
d={},g=null,h=null;1===a.class&&1===projectData.project.projectType&&projectData.writePerm&&(null===projectData.preRelease?null===projectData.release?d.submit="Submit":b>projectData.release.buildId?d.submit="Update":b===projectData.release.buildId&&(h=getRelativeRootPath()+"p/"+projectData.release.name+"/"+projectData.release.version):b>projectData.preRelease.buildId?d.update="Update":b===projectData.preRelease.buildId&&(g=getRelativeRootPath()+"p/"+projectData.preRelease.name+"/"+projectData.preRelease.version));
b=$("<select><option value='---' style='font-weight: bolder;'>Choose...</option></select>").addClass("ci-project-history-action-select").change(function(){var b=this.value;if("submit"===b||"update"===b)window.location=getRelativeRootPath()+b+"/"+projectData.path.join("/")+"/"+a.internal;this.value="---"});for(var e in d)b.append($("<option></option>").attr("value",e).text(d[e]));$("<td class='ci-project-history-action-cell'></td>").append(b).appendTo(c);d=getRelativeRootPath()+"babs/"+a.buildId.toString(16);
e=function(){f(a.class,a.internal,!1);return!1};$("<td class='ci-project-history-build-number'></td>").append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text(PoggitConsts.BuildClass[a.class]+" #"+a.internal).attr("href",d).click(e)).append(h?" <a style='color: red;' href='"+h+"'>[R]</a>":g?" <a style='color: red;' href='"+g+"'>[P]</a>":"")).append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text("(&"+a.buildId.toString(16)+")").attr("href",d).click(e))).appendTo(c);$("<td class='ci-project-history-date'></td>").append($("<span class='time-elapse' data-max-elapse='604800'></span>").attr("data-timestamp",
a.date)).appendTo(c);g=PoggitConsts.LintLevel[a.worstLint];$("<td class='ci-project-history-lint'></td>").addClass("lint-style-"+g.toLowerCase().replace(" ","-")).append($("<p></p>").text(0===a.lintCount?"OK":a.lintCount+" problem"+(1!==a.lintCount?"s":"")).css("margin-bottom","0")).appendTo(c);$("<td class='ci-project-history-commit'></td>").append($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/commit/"+a.sha).append($("<code></code>").text(a.sha?
a.sha.substring(0,7):"unknown"))).append($("<span></span>").addClass("ci-build-commit-message").attr("data-sha",a.sha).hover(v(!0),v(!1))).appendTo(c);g=$("<td class='ci-project-history-branch'></td>").appendTo(c);4===a.class?(g.text("#"+a.branch),g.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/pull/"+a.branch))):(g.text(a.branch),g.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+
"/"+projectData.path[1]+"/tree/"+a.branch+"/"+a.path)));g=getRelativeRootPath()+"r/"+a.resourceId+"/"+projectData.path[2]+"_"+PoggitConsts.BuildClass[a.class].toLowerCase()+"-"+a.internal+".phar";$("<td class='ci-project-history-dl'></td>").append(1===a.resourceId?"N/A":$("<a></a>").text((Math.round(a.dlSize/102.4)/10).toString()+" KB").attr("href",g).click(function(){return 210===projectData.project.projectId||confirm("This "+(2===projectData.project.projectType?"virion":"plugin")+" has not been reviewed, and it may contain dangerous code like viruses. Do you still want to download this file?")})).appendTo(c);
2===projectData.project.projectType&&$("<td class='ci-project-history-virion-version'></td>").text(a.virionVersion).appendTo(c);E(a);return a.$row=c}function E(b){ghApi("repositories/"+projectData.project.repoId+"/commits/"+b.sha,{},"GET",function(a){b.commitMessage=a.commit?a.commit.message:"unknown";b.authorName=a.commit?a.commit.author.name:"unknown";b.authorLogin=a.commit?a.author.login:"unknown";F(a.sha,b.commitMessage,b.authorName,b.authorLogin)})}function F(b,a,c,d){$("span.ci-build-commit-message[data-sha='"+
b+"']").each(function(){var b=$(this);b.empty();b.text(a.split("\n")[0]);$("<span class='ci-build-commit-details'></span>").text(a.split("\n").slice(1).join("\n")).appendTo(b);$("<a target='_blank'></a>").attr("href","https://github.com/"+d).attr("title",c).append($("<img width='16'/>").attr("src","https://github.com/"+d+".png?width=20").css("margin","5px")).prependTo(b)})}function v(b){return function(){$(this).find(".ci-build-commit-details").css("display",b?"block":"none")}}var q={},r=null,n=$("#ci-build-inner"),
z=$("#ci-build-pane");$("#ci-build-close").click(function(){h(!0)});var C=$("#ci-build-header"),w=!1,x,A=!1,D=null;n.find(".ci-build-commit-message").hover(v(!0),v(!1));var u=function(){var b;return function(a){if("undefined"!==typeof b)return b;if(a)return null;b=$("<div id='build-pane-dialog'></div>");b.dialog({autoOpen:!1,modal:!0,position:modalPosition,close:function(){A||h(!0)},open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#build-pane-dialog").dialog("close")})}});return b}}(),
p={showNarrow:function(){var b=u();b.dialog("option","title",C.text());n.appendTo(b);c(b);b.dialog("open")},hideNarrow:function(){var b=u();A=!0;b.dialog("close");A=!1},showWide:function(){n.appendTo(z);z.css("display","flex")},hideWide:function(){z.css("display","none")}};(function(){function b(a){x=a;w&&(a?(p.hideWide(),p.showNarrow()):(p.hideNarrow(),p.showWide()))}var a=window.matchMedia("(max-width: 1000px)");b(a.matches);a.addListener(function(a){b(a.matches)});$(window).resize(function(){var a=
u(!0);null!==a&&c(a)})})();window.addEventListener("popstate",function(){t(!0)});t(!1);var H=document.getElementById("projectPath"),B=/^https:\/\/github\.com\/([a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38})\/([a-z0-9_.-]+)\/tree\/master\/?(.*)/i.exec(H.href);ghApi("repos/"+B[1]+"/"+B[2],{},"GET",function(b){H.href="https://github.com/"+b.full_name+"/tree/"+b.default_branch+"/"+B[3]});var I=getParameterByName("branch","special:dev");$("#ci-project-history-branch-select").val(I);y(I,-1,10);$("#ci-project-history-load-more").click(function(){$(this).hasClass("disabled")||
($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),null!==r&&y(r.branch,r.tail,10,r.pr))});$("#ci-project-history-branch-select").change(function(){function b(a,b){return"special:dev"===b?!0:"special:pr"===b?4===a.class:b===a.branch}var a=$("#ci-project-history-table");a.find(".ci-project-history-content-row").detach();var c=this.value,d=Object.valuesToArray(q);d.sort(function(a,b){return b.date-a.date});for(var g=0,f=-1,e=0;e<d.length;++e)b(d[e],c)&&(a.append(G(d[e].buildId)),
++g,-1===f||f>d[e].internal)&&(f=d[e].internal);10>g&&($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),y(c,f,10-g,"special:pr"===c))})});
