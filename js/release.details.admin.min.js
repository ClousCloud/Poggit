$(function(){function h(a){ajax("release.statechange",{data:{relId:releaseDetails.releaseId,state:a,message:c.val()},method:"POST",success:function(){location.replace(getRelativeRootPath()+("p/"+releaseDetails.name+"/"+releaseDetails.version))}})}var f,a=$("<div></div>"),c=$("<textarea cols='80' rows='10'></textarea>").appendTo(a);a.dialog({autoOpen:!1,position:modalPosition,modal:!0,buttons:{Post:function(){ghApi(releaseDetails.rejectPath,{body:c.val()},"POST",f)}}});var g=$("<select class='inline-select'></select>").change(function(){ajax("release.statechange",
{data:{relId:releaseDetails.releaseId,state:g.val()},method:"POST",success:function(){location.replace(getRelativeRootPath()+("p/"+releaseDetails.name+"/"+releaseDetails.version))}})}),d;for(d in PoggitConsts.ReleaseState)if(PoggitConsts.ReleaseState.hasOwnProperty(d)){var k=PoggitConsts.ReleaseState[d],l=$("<option></option>").attr("value",k).text(d.ucfirst());l.prop("selected",releaseDetails.state===k);l.appendTo(g)}var e=$("<select></select>"),b;for(b in PoggitConsts.Staff)PoggitConsts.Staff.hasOwnProperty(b)&&
PoggitConsts.Staff[b]>=PoggitConsts.AdminLevel.REVIEWER&&e.append($("<option></option>").attr("value",b).text(b));e.val(sessionData.session.loginName.toLowerCase());var m=$("<div></div>").append(e).dialog({autoOpen:!1,position:modalPosition,modal:!0,title:"Assign release",buttons:{Assign:function(){return ajax("review.assign",{data:{releaseId:releaseDetails.releaseId,assignee:e.val()},success:function(){return window.location.reload()}})},Unassign:function(){return ajax("review.assign",{data:{releaseId:releaseDetails.releaseId,
assignee:""},success:function(){return window.location.reload()}})}}});$("<div id='release-admin'></div>").append($("<span class='action'>Pending...</span>").click(function(){a.dialog("option","title","Mark as pending");c.val("> Dear @"+releaseDetails.project.repo.owner+':\n> Regarding the release you submitted, named "**'+releaseDetails.name+'**" (v'+releaseDetails.version+"), for the project ["+releaseDetails.project.name+"](https://poggit.pmmp.io/ci/"+releaseDetails.project.repo.owner+"/"+releaseDetails.project.repo.name+
"/"+releaseDetails.project.name+") on "+(new Date(1E3*releaseDetails.created)).toISOString()+", there are some problems with the values in the submit form.\n\n\n\n> Your release has been reset to draft. Please [edit the release](https://poggit.pmmp.io/edit/"+releaseDetails.project.repo.owner+"/"+releaseDetails.project.repo.name+"/"+releaseDetails.project.name+"/"+releaseDetails.build.internal+') to resolve these problems, then click "Submit" on the edit page to have the plugin reviewed again.\n> Note: This comment is created here because this is the last commit when the released build was created.');
f=function(){h(PoggitConsts.ReleaseState.draft)};a.dialog("open")})).append($("<span class='action'>Reject...</span>").click(function(){a.dialog("option","title","Reject plugin");c.val("> Dear @"+releaseDetails.project.repo.owner+':\n> I regret to inform you that the release you submitted, named "**'+releaseDetails.name+'**" (v'+releaseDetails.version+"), for the project ["+releaseDetails.project.name+"](https://poggit.pmmp.io/ci/"+releaseDetails.project.repo.owner+"/"+releaseDetails.project.repo.name+
"/"+releaseDetails.project.name+") on "+(new Date(1E3*releaseDetails.created)).toISOString()+", has been rejected.\n\n\n\n> Please resolve the issues listed above and submit the updated plugin again.\n> Note: This comment is created here because this is the last commit when the released build was created.");f=function(){h(PoggitConsts.ReleaseState.rejected)};a.dialog("open")})).append(g).append($("<span class='action'>Assign</span>").click(function(){return m.dialog("open")})).insertAfter("#release-admin-marker")});
