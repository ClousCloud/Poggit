var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var c=this;c instanceof String&&(c=String(c));var e=c.length;for(b=b||0;b<e;b++)if(c[b]==a||Object.is(c[b],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");var submitEntries=[];
$(function(){var a=PoggitConsts.Config,c,b;submitEntries.push("About this plugin");submitEntries.push(new SubmitFormEntry("name",submitData.fields.name,"Plugin Name","submit2-name",StringEntry({size:32},function(a,b,c){var e=this;this.locked?"undefined"!==typeof c&&c.preventDefault():(e.ajaxLock=a,e.invalid=!0,ajax("release.submit.validate.name",{data:{name:a},method:"POST",success:function(b){e.ajaxLock===a&&(e.invalid=!b.ok,e.reactInput(b.message,b.ok?"form-input-good":"form-input-error"))}}))}),
function(){return{valid:!this.invalid,message:"Invalid plugin name: "+this.$getRow().find(".form-input-react").text()}},!1,"submit"!==submitData.mode));submitEntries.push(new SubmitFormEntry("shortDesc",submitData.fields.shortDesc,"Synopsis","submit2-tagline",StringEntry({size:64,maxlength:128}),function(){var b=this.getValue();return{valid:b.length>=a.MIN_SHORT_DESC_LENGTH&&b.length<=a.MAX_SHORT_DESC_LENGTH,message:"The length of the synopsis must be within "+a.MIN_SHORT_DESC_LENGTH+" and "+a.MAX_SHORT_DESC_LENGTH+
" characters"}}));getAdminLevel()>=PoggitConsts.AdminLevel.REVIEWER&&submitEntries.push(new SubmitFormEntry("official",submitData.fields.official,"Official?","submit2-official",BooleanEntry,function(){return{valid:!0}}));submitEntries.push(c=new SubmitFormEntry("description",submitData.fields.description,"Description","submit2-description",HybridEntry({cols:72,rows:15}),function(){return{valid:this.getValue().text.length>=a.MIN_DESCRIPTION_LENGTH,message:"The description must be at least "+a.MIN_DESCRIPTION_LENGTH+
" characters long"}}));submitEntries.push("About this version");submitEntries.push(new SubmitFormEntry("version",submitData.fields.version,"Version","submit2-version",StringEntry({size:10,maxlength:16},function(a,b,c){var e=this;this.locked?"undefined"!==typeof c&&c.preventDefault():ajax("release.submit.validate.version",{data:{version:a,projectId:submitData.buildInfo.projectId},method:"POST",success:function(a){e.invalid=!a.ok;e.reactInput(a.message,a.ok?"form-input-good":"form-input-error")}})}),
function(){return{valid:!this.invalid,message:"Invalid plugin version: "+this.$getRow().find(".form-input-react").text()}},!0,"edit"===submitData.mode));submitEntries.push(new SubmitFormEntry("preRelease",submitData.fields.preRelease,"Pre-release?","submit2-prerelease",BooleanEntry,function(){return{valid:!0}}));"edit"===submitData.mode&&submitEntries.push(new SubmitFormEntry("outdated",submitData.fields.outdated,"Outdated?","submit2-outdated",BooleanEntry,function(){return{valid:!0}}));"object"===
typeof submitData.fields.changelog&&submitEntries.push(new SubmitFormEntry("changelog",submitData.fields.changelog,"What's New","submit2-changelog",HybridEntry({cols:72,rows:8}),function(){return{valid:this.getValue().text.length>=a.MIN_CHANGELOG_LENGTH,message:"The changelog must be at least "+a.MIN_CHANGELOG_LENGTH+" characters long"}}));submitEntries.push("Help users find this plugin");submitEntries.push(new SubmitFormEntry("majorCategory",submitData.fields.majorCategory,"Major Category","submit2-majorcat",
DroplistEntry(submitData.consts.categories,{},function(a){var b=$("#submit2-minorcats").find(".cbinput");b.removeClass("submit-cb-disabled").children(".submit-cb").prop("disabled",!1);b.filter(function(){var b=this.getElementsByClassName("submit-cb");console.assert(1===b.length);return Number(b[0].value)===Number(a)}).addClass("submit-cb-disabled").find(".submit-cb").prop("disabled",!0)}),function(){return{valid:!0}}));submitEntries.push(new SubmitFormEntry("minorCategories",submitData.fields.minorCategories,
"Minor Categories","submit2-minorcats",CompactMultiSelectEntry(submitData.consts.categories),function(){return{valid:!0}}));submitEntries.push(new SubmitFormEntry("keywords",submitData.fields.keywords,"Keywords","submit2-keywords",StringEntry,function(){var b=this.getValue();if(b.split(" ").length>a.MAX_KEYWORD_COUNT)return{valid:!1,message:"Too many keywords! Only supply up to "+a.MAX_KEYWORD_COUNT+" keywords."};for(var c=0;c<b.length;++c)if(b[c].length>a.MAX_KEYWORD_LENGTH)return{valid:!1,message:'The keyword "'+
b[c]+'" is too long. Each keyword should not have more than '+a.MAX_KEYWORD_LENGTH+" characters."};return{valid:!0}}));submitEntries.push("About installation");submitEntries.push(new SubmitFormEntry("deps",submitData.fields.deps,"Dependencies","submit2-deps",DepTableEntry,function(){return{valid:!0}}));submitEntries.push(new SubmitFormEntry("requires",submitData.fields.reqrs,"Manual Setup","submit2-requires",RequiresTableEntry,function(){return{valid:!0}}));submitEntries.push(new SubmitFormEntry("spoons",
submitData.fields.spoons,"Supported APIs","submit2-spoons",SpoonTableEntry,function(){return{valid:1<=this.getValue().length,message:"There must be at least one supported API version range!"}},!0,"edit"===submitData.mode));submitEntries.push("Plugin association");submitEntries.push(new SubmitFormEntry("assocParent",submitData.fields.assocParent,"Associate Release of:","submit2-assoc-parent",AssocParentEntry,function(){return{valid:!0}}));0<submitData.assocChildren.length&&submitEntries.push(new SubmitFormEntry("assocChildrenUpdates",
submitData.fields.assocChildren,"Children Associate Releases","submit2-assoc-children-updates",ExpandedMultiSelectEntry(submitData.assocChildren,!0),function(){return{valid:!0}}));submitEntries.push("Other details");submitEntries.push(new SubmitFormEntry("license",submitData.fields.license,"License","submit2-license",LicenseEntry,function(){return{valid:!0}}));submitEntries.push(new SubmitFormEntry("perms",submitData.fields.perms,"Permissions","submit2-perms",ExpandedMultiSelectEntry(submitData.consts.perms,
!0),function(){return{valid:!0}}));submitEntries.push(b=new SubmitFormEntry("authors",submitData.fields.authors,"Producers","submit2-authors",AuthorsTableEntry,function(){return{valid:this.getValue().length>=b.type.minRows,message:"There must be at least 1 producer!"}}));setupReadmeImports(c);setTimeout(refreshAuthors,500,b);c=$(".form-table");c.empty();for(var d=0;d<submitEntries.length;++d)submitEntries[d].constructor===String?$("<div class='form-subtitle'></div>").append($("<span></span>").text(submitEntries[d])).appendTo(c):
submitEntries[d].constructor===SubmitFormEntry&&submitEntries[d].appendTo(c);for(d=0;d<submitEntries.length;++d)submitEntries[d].constructor===SubmitFormEntry&&submitEntries[d].setDefaults();$("#submit2-assoc-children-updates").find("input.submit-cb").prop("checked",!0);c.append($("<div class='form-row'></div>").append("<div class='form-key'>Icon</div>").append($("<div class='form-value'></div>").html(submitData.icon.html)).append($("<div class='form-icon-preview'></div>").append($("<img/>").attr("src",
null===submitData.icon.url?getRelativeRootPath()+"res/defaultPluginIcon2.png":submitData.icon.url))));d=$("<div class='submitbuttons'></div>");var e=null,f=null;"edit"!==submitData.mode?(e=null!==submitData.last?"Submit Update":"Submit Plugin",f="Save as Draft"):0===submitData.refRelease.state?(e=null!==submitData.last?"Submit Update from Draft":"Submit Plugin from Draft",f="Save Edit"):2===submitData.refRelease.state?(e="Save Edit",f="Restore to Draft"):e="Save Edit";null!==e&&d.append($("<span class='action'></span>").text(e).click(function(){$(this).addClass("disabled");
uploadForm("submit")}));null!==f&&d.append($("<span class='action'></span>").text(f).click(function(){$(this).addClass("disabled");uploadForm("draft")}));d.appendTo(c)});
function uploadForm(a){var c=!1;$(".submit-deps-version").each(function(){"undefined"===typeof $(this).attr("data-relid")&&(alert("You haven't selected the version in one of the dependencies yet!"),c=!0)});if(!c)if(0<$("#submit-assoc-parent-name").val().length&&"undefined"===typeof $("#submit-assoc-parent-version").attr("data-relid"))alert("You haven't selected the version for the associate release parent yet!");else{for(var b=0;b<submitEntries.length;++b)if(submitEntries[b].constructor===SubmitFormEntry&&
!submitEntries[b].locked){var d=submitEntries[b].validator.call(submitEntries[b]);if(!d.valid){if("submit"===a){alert("Cannot submit due to a problem in "+submitEntries[b].name+":\n\n"+d.message);return}if(!confirm("Warning: This plugin cannot be submitted due to a problem in "+submitEntries[b].name+":\n\n"+d.message+"\n\nDo you still want to save this draft?"))return}}a={form:getAllValues(),action:a,submitFormToken:submitData.submitFormToken};ajax("submit.new.ajax",{method:"POST",data:JSON.stringify(a),
success:function(a){a.status?window.location=a.link:alert(a.error)},error:function(a){a=JSON.parse(a.responseText);alert(a.error)}})}}function showErrorPage(a){var c=$("#body");c.empty();var b=$("<p id='fallback-error'></p>");b.text(a);b.appendTo(c)}function applyAttrs(a,c){if("object"===typeof c)for(var b in c)c.hasOwnProperty(b)&&("boolean"===typeof c[b]?a.prop(b,c[b]):a.attr(b,c[b]))}
function setupReadmeImports(a){ghApi("search/code?q="+encodeURIComponent("readme in:path repo:"+submitData.repoInfo.full_name),{},"GET",function(c){c=c.items;var b=submitData.buildInfo.path;c.sort(function(a,c){var e=a.path.substring(0,b.length)===b,d=c.path.substring(0,b.length)===b;return e&&d?Math.compare(a.path.length,c.path.length):e!==d?e?-1:1:a.path===a.name?-1:c.path===c.name?1:a.path.localeCompare(c.path)});for(var d=a.$getRow(),e=0;e<c.length;++e){var f=d.find(".form-value-defaults"),g=
$("<span class='action form-value-import'></span>");g.text("Import from "+c[e].path);g.click(function(a){return function(){$.get("https://raw.githubusercontent.com/"+submitData.repoInfo.full_name+"/"+submitData.repoInfo.default_branch+"/"+a.path,{},function(a){d.find(".submit-hybrid-content").val(a);d.find(".submit-hybrid-format").val("sm")})}}(c[e]));g.appendTo(f)}})}
function refreshAuthors(a){var c=a.$getRow().find(".submit-tableentry-row");c.each(function(){var a=$(this),d=a.find(".submit-authors-name");if(a.prop("data-changed")||a.prop("data-duplicated")){var e=a.find(".submit-authors-name-react"),f=d.val();a.prop("data-changed",!1).prop("data-duplicated",!1);var g=a.find(".submit-authors-avatar");g.attr("src",getRelativeRootPath()+"res/ghMark.png");e.removeClass("form-input-good form-input-error").html("&nbsp;");if(f.toLowerCase()===submitData.repoInfo.owner.login.toLowerCase())"User"===
submitData.repoInfo.owner.type?e.addClass("form-input-error").html("&cross; Duplicated producer"):e.addClass("form-input-error").html("&cross; Only users can be added as producers.");else if(1<c.find(".submit-authors-name").filter(function(){return this.value===f}).length)e.addClass("form-input-error").html("&cross; Duplicated producer"),a.prop("data-duplicated",!0);else if(/^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38}$/i.test(f)){var h=f.toLowerCase();a.attr("data-lock",h);ghApi("users/"+f,{},"GET",function(b){a.attr("data-lock")===
h&&("undefined"!==typeof b.avatar_url?"User"!==b.type?e.addClass("form-input-error").html("&cross; Only users can be added as producers. @"+f+" is an "+b.type.toLowerCase()+"."):(g.attr("src",b.avatar_url),e.addClass("form-input-good").html("&checkmark; "+(null===b.name?"Found user":"Found user ("+b.name+")")),a.attr("data-uid",b.id)):e.addClass("form-input-error").html("&cross; @"+f+" was not registered on GitHub!"))})}else e.addClass("form-input-error").html("&cross; Invalid username")}});setTimeout(refreshAuthors,
500,a)}function getAllValues(){for(var a={},c=0;c<submitEntries.length;++c)if(submitEntries[c].constructor===SubmitFormEntry&&!submitEntries[c].locked){var b=submitEntries[c].getValue();null!==b&&(a[submitEntries[c].submitKey]=b)}return a}
function SubmitFormEntry(a,c,b,d,e,f,g,h){"function"===typeof e&&(e=e());console.assert("function"===typeof e.appender);console.assert("function"===typeof e.getter);console.assert("function"===typeof e.setter);console.assert("boolean"===typeof e.afterRemarks);console.assert("function"===typeof f);this.type=e;this.validator=f;this.id=d;this.submitKey=a;this.name=b;this.rem=c.remarks;this.refDefault=c.refDefault;this.srcDefault=c.srcDefault;this.prefSrc="edit"===submitData.mode?!1:"undefined"===typeof g?
!1:g;this.locked="undefined"===typeof h?!1:h;this.isThisFirstEntry=this.constructor.isNextFirstEntry;this.constructor.isNextFirstEntry=!1}SubmitFormEntry.isNextFirstEntry=!0;SubmitFormEntry.prototype.$getRow=function(){return $(document.getElementById(this.id))};
SubmitFormEntry.prototype.appendTo=function(a){var c=$("<div class='form-row'></div>").attr("id",this.id);$("<div class='form-key'></div>").text(this.name).appendTo(c);var b=$("<span></span>").addClass("explain").html(this.rem),d=$("<div class='form-value'></div>");this.type.afterRemarks?(b.addClass("explain-before-input").appendTo(d),this.type.appender.call(this,d)):(this.type.appender.call(this,d),b.addClass("explain-after-input").appendTo(d));d.appendTo(c);$("<div class='form-input-react'></div>").appendTo(d);
var e=this;if(!this.locked){b=$("<div class='form-value-defaults'></div>");var f=d=null;null!==this.refDefault&&(d=$("<span class='action form-value-import'></span>").text("edit"===submitData.mode?"Reset":this.isThisFirstEntry?"Copy from last release":"Copy"),d.click(function(){e.type.setter.call(e,e.refDefault)}));null!==this.srcDefault&&(f=$("<span class='action form-value-import'></span>").text(this.isThisFirstEntry?"Detect from code":"Detect"),f.click(function(){e.type.setter.call(e,e.srcDefault)}));
this.prefSrc?(null!==f&&f.appendTo(b),null!==d&&d.appendTo(b)):(null!==d&&d.appendTo(b),null!==f&&f.appendTo(b));b.appendTo(c)}c.appendTo(a)};SubmitFormEntry.prototype.setDefaults=function(){if(this.prefSrc)if(null!==this.srcDefault)var a=this.srcDefault;else null!==this.refDefault&&(a=this.refDefault);else null!==this.refDefault?a=this.refDefault:null!==this.srcDefault&&(a=this.srcDefault);void 0!==a?this.type.setter.call(this,a):"function"===typeof this.type.noDefaults&&this.type.noDefaults.call(this)};
SubmitFormEntry.prototype.reactInput=function(a,c){var b=this.$getRow().find(".form-input-react");b.html(a);if("object"===typeof this.classes&&this.classes.constructor===Array)for(a=0;a<this.classes.length;++a)b.removeClass(this.classes[a]);this.classes=[];if("string"===typeof c)this.classes.push(c),b.addClass(c);else if("object"===typeof c&&c.constructor===Array)for(a=0;a<c.length;++a)this.classes.push(c[a]),b.addClass(c[a])};
SubmitFormEntry.prototype.getValue=function(){return this.locked?null:this.type.getter.call(this)};SubmitFormEntry.prototype.isValid=function(){return this.validator.call(this)};
function StringEntry(a,c){return{appender:function(b){var d=$("<input/>");d.addClass("submit-textinput");this.locked&&d.prop("disabled",!0);applyAttrs(d,a);if("function"===typeof c){var e=this;d.on("input",function(a){a=c.call(e,d.val(),d,a);"string"===typeof a&&d.val(a)})}d.appendTo(b)},getter:function(){return this.$getRow().find(".submit-textinput").val()},setter:function(a){var b=this.$getRow().find(".submit-textinput");b.val(a);"function"===typeof c&&c.call(this,a,b,void 0)},afterRemarks:!1}}
function BooleanEntry(a){return{appender:function(c){var b=$("<input type='checkbox'/>");b.addClass("submit-checkinput");this.locked&&b.prop("disabled",!0);applyAttrs(b,a);b.appendTo(c)},getter:function(){return this.$getRow().find(".submit-checkinput").prop("checked")},setter:function(a){this.$getRow().find(".submit-checkinput").prop("checked",a)},afterRemarks:!1}}
function HybridEntry(a){return{appender:function(c){var b=$("<textarea></textarea>");b.addClass("submit-hybrid-content");this.locked&&b.prop("disabled",!0);applyAttrs(b,a);b.appendTo(c);b=$("<div></div>");b.append("<label style='padding: 5px;'>Format:</label>");var d=$("<select style='display: inline-flex;'></select>");d.addClass("submit-hybrid-format");var e=$("<option value='txt'></option>");e.text("Plain Text (you may indent with spaces)");e.appendTo(d);e="https://github.com/"+submitData.repoInfo.full_name+
"/tree/"+submitData.buildInfo.sha.substring(0,7)+"/";var f=$("<option value='sm'></option>");f.text("Standard Markdown (rendered like README, links relative to "+e+")");f.appendTo(d);f=$("<option value='gfm'></option>");f.text("GFM (rendered like issue comments, links relative to "+e+")");f.appendTo(d);d.appendTo(b);b.appendTo(c)},getter:function(){var a=this.$getRow();return{text:a.find(".submit-hybrid-content").val(),type:a.find(".submit-hybrid-format").val()}},setter:function(a){var b=this.$getRow();
b.find(".submit-hybrid-content").val(a.text);b.find(".submit-hybrid-format").val(a.type)},afterRemarks:!1}}
function LicenseEntry(){var a={},c=function(){var a=$("<div id='licenseViewDialog'></div>"),c=$("<div id='licenseDialogLoading'></div>").css("font-size","x-large").text("Loading..."),e=$("<div id='licenseDialogInner'></div>").css("display","none");c.appendTo(a);e.appendTo(a);var f=$("<p id='licenseDescription'></p>");f.appendTo(e);var g=$("<div id='licenseMetaDiv'></div>").css("display","flex"),h={permissions:"Permissions",conditions:"Conditions",limitations:"Limitations"},k={};for(n in h)if(h.hasOwnProperty(n)){var l=
$("<div class='license-metadata'></div>");$("<div></div>").css("font-weight","bold").text(h[n]).appendTo(l);var m=$("<ul></ul>");k[n]=m;m.appendTo(l);l.appendTo(g)}g.appendTo(e);var n=$("<pre></pre>");n.appendTo(e);a.dialog({autoOpen:!1,width:600,clickOut:!0,responsive:!0,height:.8*window.innerHeight,position:{my:"center top",at:"center top+100",of:window}});return{dialogDiv:a,innerLoadingDiv:c,innerDialogDiv:e,ulNames:h,ulList:g,description:f,metadataUls:k,bodyPre:n}};return{appender:function(b){var d=
this;this.ready=!1;var e=$("<select></select>").addClass("submit-license-type").append($("<optgroup label='Special'></optgroup>").append($("<option></option>").text("No License").attr("value","none")).append($("<option></option>").text("Custom License").attr("value","custom")));var f=$("<optgroup></optgroup>").attr("label","Featured");f.appendTo(e);var g=$("<optgroup></optgroup>").attr("label","Others");g.appendTo(e);e.change(function(){h.css("display","custom"===e.val()?"block":"none");var a="none"===
e.val()||"custom"===e.val();l.hasClass("disabled")!==a&&(a?l.addClass("disabled"):l.removeClass("disabled"))}).appendTo(b);var h=$("<textarea></textarea>").addClass("submit-license-custom").css("display","none").appendTo(b);var k=c();var l=$("<span></span>").addClass("action disabled").attr("id","licenseView").text("View license details").click(function(){var b=e.val();void 0!==a[b]&&(b=a[b],k.dialogDiv.dialog("option","title",b.name),k.dialogDiv.dialog("open"),k.innerLoadingDiv.css("display","block"),
k.innerDialogDiv.css("display","none"),ghApi("licenses/"+b.key,{},"GET",function(a){k.description.text(a.description);for(var b in k.ulNames){var c=k.metadataUls[b],e=a[b];c.empty();for(var d=0;d<e.length;++d)$("<li></li>").text(e[d]).appendTo(c)}k.bodyPre.text(a.body);k.innerLoadingDiv.css("display","none");k.innerDialogDiv.css("display","block")},void 0,"Accept: application/vnd.github.drax-preview+json"))}).appendTo(b);ghApi("licenses",{},"GET",function(b){b.sort(function(a,b){return a.name.localeCompare(b.name)});
for(var c=0;c<b.length;c++){var h=$("<option></option>");h.attr("value",b[c].key);h.attr("data-url",b[c].url);h.text(b[c].name);a[b[c].key]=b[c];"undefined"!==typeof d.wannaSet&&b[c].key===d.wannaSet.type&&(h.prop("selected",!0),l.removeClass("disabled"));h.appendTo(b[c].featured?f:g)}d.ready=!0;"undefined"!==typeof d.wannaSet&&e.val(d.wannaSet.type)},void 0,"Accept: application/vnd.github.drax-preview+json")},getter:function(){if(!this.ready)return this.wannaSet;var a=this.$getRow(),c=a.find(".submit-license-type").val();
return{type:c,custom:"custom"===c?a.find(".submit-license-custom").val():null}},setter:function(a){if(this.ready||"custom"===a.type||"none"===a.type){var b=this.$getRow();b.find(".submit-license-type").val(a.type);"custom"===a.type&&b.find(".submit-license-custom").val(a.custom)}else this.wannaSet=a},afterRemarks:!1}}
function DroplistEntry(a,c,b){return{appender:function(d){var e=$("<select></select>");e.addClass("submit-selinput");this.locked&&e.prop("disabled",!0);for(var f in a)if(a.hasOwnProperty(f)){var g=$("<option></option>");g.attr("value",f);g.text(a[f]);g.appendTo(e)}applyAttrs(e,c);if("function"===typeof b){var h=this;e.change(function(a){a=b.call(h,e.val(),e,a);"string"===typeof a&&e.val(a)})}e.appendTo(d)},getter:function(){return this.$getRow().find(".submit-selinput").val()},setter:function(a){this.$getRow().find(".submit-selinput").val(a);
"function"===typeof b&&b.call(this,a)},noDefaults:function(){"function"===typeof b&&b.call(this,this.$getRow().find(".submit-selinput").val())},afterRemarks:!1}}
function CompactMultiSelectEntry(a,c,b,d){return{appender:function(e){var f=$("<div></div>");f.addClass("submit-cbgrp-compact");for(var g in a)if(a.hasOwnProperty(g)){var h=$("<div class='cbinput'></div>"),k=$("<input type='checkbox'/>");k.addClass("submit-cb");k.attr("value",g);k.appendTo(h);h.append(a[g]);h.appendTo(f);this.locked&&k.prop("disabled",!0);applyAttrs(k,c);applyAttrs(h,b)}applyAttrs(f,d);f.appendTo(e)},getter:function(){return this.$getRow().find(".submit-cb:checked").map(function(){return this.value}).get()},
setter:function(a){this.$getRow().find(".submit-cb").not(".submit-cb-disabled").each(function(){this.checked=a.map(String).includes(this.value)})},afterRemarks:!1}}
function ExpandedMultiSelectEntry(a,c){return{afterRemarks:c,appender:function(b){var c=$("<div></div>");c.addClass("submit-expcb-wrapper");for(var e in a)if(a.hasOwnProperty(e)){var f=$("<div></div>").addClass("submit-expcb-row"),g=$("<div></div>").addClass("cbinput"),h=$("<input type='checkbox'/>").addClass("submit-cb").attr("value",e);h.appendTo(g);this.locked&&h.prop("disabled",!0);g.append("<div class='cblabel'>"+a[e].name+"</div>");g.appendTo(f);$("<div></div>").addClass("remark").text(a[e].description).appendTo(f);
f.appendTo(c)}c.appendTo(b)},getter:function(){return this.$getRow().find(".submit-cb:checked").map(function(){return this.value}).get()},setter:function(a){this.$getRow().find(".submit-cb").not(".submit-cb-disabled").each(function(){this.checked=a.map(String).includes(this.value)})}}}
function TableEntry(a,c,b,d,e){function f(a,b){var d=$("<tr class='submit-tableentry-row'></tr>");c(d,b);b=$("<td></td>");$("<span class='action'>&cross;</span>").click(function(){a.find(".submit-tableentry-row").length<=e?alert("There must be at least "+e+" rows!"):d.remove()}).appendTo(b);b.appendTo(d);d.appendTo(a);return d}"undefined"===typeof e&&(e=0);return{appender:function(b){var c=$("<table class='submit-tableentry-table'></table>");a(c);for(var d=0;d<e;++d)f(c,this);c.appendTo(b);var g=
this;$("<span class='action'>&plus;</span>").click(function(){f(c,g)}).appendTo(b)},getter:function(){var a=[];this.$getRow().find(".submit-tableentry-row").each(function(){var c=b($(this));null!==c&&a.push(c)});return a},setter:function(a){console.assert(a.constructor===Array,"values passed for "+this.name+" is not array but ",a);var b=this.$getRow().find(".submit-tableentry-table");b.children(".submit-tableentry-row").remove();for(var c=0;c<a.length;++c){var e=f(b,this);d(e,a[c])}},minRows:e,afterRemarks:!1}}
function AuthorsTableEntry(){return TableEntry(function(a){$("<tr class='submit-authors-row-default'></tr>").append($("<th>GitHub username</th>").css("width","200px")).append("<th>Type</th>").appendTo(a);var c=submitData.repoInfo.owner;"User"===c.type&&$("<tr></tr>").append($("<td class='submit-authors-user-cell'></td>").append($("<img height='28' class=submit-authors-avatar'/>").attr("src",c.avatar_url)).append($("<input class='submit-authors-name' size='15' disabled/>").val(c.login)).append($("<div class='submit-authors-name-react form-input-good'>The repo owner is an implicit collaborator</div>"))).append($("<td class='submit-authors-level-cell'></td>").append("<select class='submit-authors-level' disabled><option selected>Collaborator</option></select>")).appendTo(a)},
function(a){$("<td class='submit-authors-user-cell'></td>").append($("<img height='28' class='submit-authors-avatar'/>").attr("src",getRelativeRootPath()+"res/ghMark.png")).append($("<input class='submit-authors-name' size='15'/>").on("input",function(){a.prop("data-changed",!0);a.removeAttr("data-uid")})).append($("<div class='submit-authors-name-react'>&nbsp;</div>")).appendTo(a);var c=$("<select class='submit-authors-level'></select>"),b;for(b in submitData.consts.authors)if(submitData.consts.authors.hasOwnProperty(b)){var d=
submitData.consts.authors[b];$("<option></option>").attr("value",b).text(d).appendTo(c)}$("<td class='submit-authors-level-cell'></td>").append(c).appendTo(a)},function(a){return"undefined"===typeof a.attr("data-uid")?null:{uid:a.attr("data-uid"),name:a.find(".submit-authors-name").val(),level:a.find(".submit-authors-level").val()}},function(a,c){a.attr("data-uid",c.uid);a.prop("data-changed",!0);a.find(".submit-authors-name").val(c.name);a.find(".submit-authors-level").val(c.level)},"Organization"===
submitData.repoInfo.owner.type?1:0)}
function SpoonTableEntry(){function a(a){for(var b in submitData.consts.spoons)submitData.consts.spoons.hasOwnProperty(b)&&$("<option></option>").addClass("submit-spoons-option").attr("value",b).text(b).appendTo(a)}return TableEntry($.noop,function(c,b){var d=$("<select class='submit-spoons-start'></select>"),e=$("<select class='submit-spoons-end'></select>");b.locked&&(d.prop("disabled",!0),e.prop("disabled",!0));var f=submitData.consts.spoons,g=Object.sizeof(f),h=Object.keysToArray(f),k=Object.valuesToArray(f);
a(d);a(e);var l=d.children("option"),m=e.children("option");d.change(function(){var a=h.indexOf(this.value),b=e.val(),c=h.indexOf(b);m.prop("disabled",!1);m.slice(0,a).prop("disabled",!0);for(var d=a;d<g;++d)g===d+1||k[d+1].incompatible?m.eq(d).prop("disabled",!1):m.eq(d).prop("disabled",!0);c<a&&(c=a);if(c+1<f.length&&!k[c+1].incompatible){for(a=c+1;a<g;++a)if(a+1===g||k[a+1].incompatible){c=a;break}console.assert(c===a);b=h[b];e.val(b);e.change()}});e.change(function(){var a=h.indexOf(d.val()),
b=h.indexOf(e.val());l.slice(0,b+1).prop("disabled",!1);l.slice(b+1).prop("disabled",!0);a>b&&d.val(h[b])});d.val(submitData.consts.promotedSpoon);e.val(Object.keysToArray(submitData.consts.spoons).slice(-1)[0]);d.wrap("<td></td>").parent().appendTo(c);c.append("<td>&mdash;</td>");e.wrap("<td></td>").parent().appendTo(c)},function(a){return[a.find(".submit-spoons-start").val(),a.find(".submit-spoons-end").val()]},function(a,b){var c=a.find(".submit-spoons-start").val(b[0]);a=a.find(".submit-spoons-end").val(b[1]);
c.change();a.change()},1)}
function RequiresTableEntry(){return TableEntry(function(a){$("<tr></tr>").append($("<th>Required?</th>").css("width","150px")).append($("<th>Type</th>").css("width","250px")).append($("<th>Details</th>").css("width","500px")).appendTo(a)},function(a){var c=$("<select class='submit-requires-type'></select>"),b=$("<input class='submit-requires-details'/>").attr("size",50),d;for(d in submitData.consts.reqrs)if(submitData.consts.reqrs.hasOwnProperty(d)){var e=submitData.consts.reqrs[d].name;$("<option></option>").attr("value",
d).text(e).appendTo(c)}c.change(function(){b.attr("placeholder",submitData.consts.reqrs[this.value].details)}).change();a.append($("<select class='submit-requires-isrequire'></select>").append("<option value='require'>Requirement</option>").append("<option value='enhance'>Enhancement</option>").wrap("<td></td>").parent()).append(c.wrap("<td></td>").parent()).append(b.wrap("<td></td>").parent())},function(a){return{type:a.find(".submit-requires-type").val(),details:a.find(".submit-requires-details").val(),
isRequire:"require"===a.find(".submit-requires-isrequire").val()}},function(a,c){a.find(".submit-requires-type").val(c.type).change();a.find(".submit-requires-details").val(c.details);a.find(".submit-requires-isrequire").val(c.isRequire?"require":"enhance")})}
var $currentVersionTarget,versionDialogLock,currentVersions,dialogData=function(){var a=$("<div id='depSelectDialog'></div>"),c=$("<div></div>").css("font-size","x-large").text("Loading versions..."),b=$("<div></div>").addClass("fallback-error"),d=$("<div></div>");d.append("<p>Select the <strong>recommended</strong> version of the dependency plugin, usually the <em>latest</em> version. You don't need to select older versions; if you want to, mention it in the Description.</p>");d.append("<p>Keep in mind that the state of your plugin will never be higher than the state of your dependencies (except Featured). For example, if your plugin depends on a release that has not been approved yet, your plugin won't get approved either before the dependency release gets approved.</p>");
var e=$("<table></table>");e.append("<tr><th>Version</th><th>Pre-release?</th><th>State on Poggit</th><th>Submission date</th></tr>").appendTo(d);a.append(c).append(b).append(d);a.dialog({autoOpen:!1,width:600,modal:!0,responsive:!0,height:.8*window.innerHeight,position:{my:"center top",at:"center top+100",of:window},buttons:{Select:function(){var a=$("input.submit-dep-dialog-version-radio:checked").attr("data-value"),b=currentVersions[a].version;$currentVersionTarget.text("Change: v"+b).attr("data-relid",
a).attr("data-version",b);$(this).dialog("close");currentVersions=versionDialogLock=$currentVersionTarget=void 0}}});return{dialog:a,loading:c,error:b,inner:d,table:e}}();
function DepTableEntry(){return TableEntry(function(a){$("<tr></tr>").append($("<th>Required?</th>").css("width","100px")).append($("<th>Plugin Name</th>").css("width","200px")).append($("<th>Version</th>")).appendTo(a)},function(a){var c=$("<input class='submit-deps-name' size='15'/>"),b=$("<span class='submit-deps-version action'>Choose a version...</span>");c.change(function(){b.text("Choose a version").removeAttr("data-relid")});b.click(function(){$currentVersionTarget=b;var a=versionDialogLock=
Math.random(),e=c.val();dialogData.dialog.dialog("option","title",'Choose a version of "'+c.val()+'"');dialogData.loading.css("display","block");dialogData.error.css("display","none");dialogData.inner.css("display","none");dialogData.dialog.dialog("open");ajax("submit.deps.getversions",{data:{name:e},success:function(b){if(a===versionDialogLock)if(0===Object.sizeof(b))dialogData.loading.css("display","none"),dialogData.error.text("There aren't any submitted (and not rejected) plugins on Poggit called "+
e).css("display","block");else{dialogData.loading.css("display","none");currentVersions=b;var c=!0;dialogData.table.find("tr.submit-deps-version-select-row").remove();for(var d in b)if(b.hasOwnProperty(d)){var f=$("<span></span>").attr("data-timestamp",b[d].submitTime);timeTextFunc.call(f.get()[0]);dialogData.table.append($("<tr></tr>").addClass("submit-deps-version-select-row").append($("<td></td>").append($("<input type='radio'/>").addClass("submit-dep-dialog-version-radio").attr("name",versionDialogLock).attr("data-value",
d).prop("checked",c)).append($("<label></label>").text(b[d].version))).append($("<td></td>").append($("<input type='checkbox' disabled/>").prop("checked",b[d].preRelease))).append($("<td></td>").append(b[d].stateName)).append($("<td></td>").append(f)));c=!1}dialogData.inner.css("display","block")}}})});a.append($("<select class='submit-deps-required'></select>").append("<option value='required'>Required</option>").append("<option value='optional'>Optional</option>").wrap("<td></td>").parent()).append(c.wrap("<td></td>").parent()).append(b.wrap("<td></td>").parent())},
function(a){var c=a.find("span.submit-deps-version");return"undefined"===typeof c.attr("data-relid")?null:{name:a.find("input.submit-deps-name").val(),version:c.attr("data-version"),depRelId:Number(c.attr("data-relid")),required:"required"===a.find("select.submit-deps-required").val()}},function(a,c){a.find("input.submit-deps-name").val(c.name);a.find("span.submit-deps-version").text("Change: v"+c.version).attr("data-version",c.version).attr("data-relid",c.depRelId);a.find("select.submit-deps-required").val(c.required?
"required":"optional")})}
function AssocParentEntry(){return{afterRemarks:!0,appender:function(a){var c=$("<input id='submit-assoc-parent-name' size='15' placeholder='Plugin Name'/>"),b=$("<span id='submit-assoc-parent-version' class='action'>Choose a version...</span>");c.change(function(){b.text("Choose a version").removeAttr("data-relid")});b.click(function(){var a=versionDialogLock=Math.random();$currentVersionTarget=b;var e=c.val();dialogData.dialog.dialog("option","title",'Choose a version of "'+c.val()+'"');dialogData.loading.css("display",
"block");dialogData.error.css("display","none");dialogData.inner.css("display","none");dialogData.dialog.dialog("open");ajax("submit.deps.getversions",{data:{name:e},success:function(b){if(a===versionDialogLock)if(0===Object.sizeof(b))dialogData.loading.css("display","none"),dialogData.error.text("There aren't any submitted (and not rejected) plugins on Poggit called "+e).css("display","block");else{dialogData.loading.css("display","none");currentVersions=b;var c=!0;dialogData.table.find("tr.submit-deps-version-select-row").remove();
for(var d in b)if(b.hasOwnProperty(d)){var f=$("<span></span>").attr("data-timestamp",b[d].submitTime);timeTextFunc.call(f.get()[0]);dialogData.table.append($("<tr></tr>").addClass("submit-deps-version-select-row").append($("<td></td>").append($("<input type='radio'/>").addClass("submit-dep-dialog-version-radio").attr("name",versionDialogLock).attr("data-value",d).prop("checked",c)).append($("<label></label>").text(b[d].version))).append($("<td></td>").append($("<input type='checkbox' disabled/>").prop("checked",
b[d].preRelease))).append($("<td></td>").append(b[d].stateName)).append($("<td></td>").append(f)));c=!1}dialogData.inner.css("display","block")}}})});$("<div></div>").css("display","flex").append(c).append(b).appendTo(a)},getter:function(){var a=this.$getRow().find("#submit-assoc-parent-version");return"undefined"===typeof a.attr("data-relid")?null:{releaseId:Number(a.attr("data-relid")),name:this.$getRow().find("submit-assoc-parent-name").val(),version:a.attr("data-version")}},setter:function(a){null!==
a&&null!==a.version&&$("#submit-assoc-parent-version").text("Change: v"+a.version).attr("data-version",a.version).attr("data-relid",a.depRelId)}}};
