var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,p,k){c instanceof String&&(c=String(c));for(var l=c.length,t=0;t<l;t++){var v=c[t];if(p.call(k,v,t,c))return{i:t,v:v}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,p,k){c!=Array.prototype&&c!=Object.prototype&&(c[p]=k.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,p,k,l){if(p){k=$jscomp.global;c=c.split(".");for(l=0;l<c.length-1;l++){var t=c[l];t in k||(k[t]={});k=k[t]}c=c[c.length-1];l=k[c];p=p(l);p!=l&&null!=p&&$jscomp.defineProperty(k,c,{configurable:!0,writable:!0,value:p})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,k){return $jscomp.findInternal(this,c,k).v}},"es6","es3");$jscomp.checkStringArgs=function(c,p,k){if(null==c)throw new TypeError("The 'this' value for String.prototype."+k+" must not be null or undefined");if(p instanceof RegExp)throw new TypeError("First argument to String.prototype."+k+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,k){var l=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var p=l.length,v=c.length;k=Math.max(0,Math.min(k|0,l.length));for(var y=0;y<v&&k<p;)if(l[k++]!=c[y++])return!1;return y>=v}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(c,k){var l=$jscomp.checkStringArgs(this,c,"endsWith");c+="";void 0===k&&(k=l.length);k=Math.max(0,Math.min(k|0,l.length));for(var p=c.length;0<p&&0<k;)if(l[--k]!=c[--p])return!1;return 0>=p}},"es6","es3");$jscomp.polyfill("Object.is",function(c){return c?c:function(c,k){return c===k?0!==c||1/c===1/k:c!==c&&k!==k}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(c){return c?c:function(c,k){var l=this;l instanceof String&&(l=String(l));var p=l.length;for(k=k||0;k<p;k++)if(l[k]==c||Object.is(l[k],c))return!0;return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(c,k){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,k||0)}},"es6","es3");
$(function(){function c(){g.push("About this plugin");g.push(new m("name",f.fields.name,"Plugin Name","submit2-name",z({size:32},function(a,b,d){var e=this;this.locked?"undefined"!==typeof d&&d.preventDefault():(e.ajaxLock=a,e.invalid=!0,ajax("release.submit.validate.name",{data:{name:a},method:"POST",success:function(b){e.ajaxLock===a&&(e.invalid=!b.ok,e.reactInput(b.message,b.ok?"form-input-good":"form-input-error"))}}))}),function(){return{valid:!this.invalid,message:"Invalid plugin name: "+this.$getRow().find(".form-input-react").text()}},
!1,"submit"!==f.mode));g.push(new m("shortDesc",f.fields.shortDesc,"Synopsis","submit2-tagline",z({size:64,maxlength:128}),function(){var a=this.getValue();return{valid:a.length>=r.MIN_SHORT_DESC_LENGTH&&a.length<=r.MAX_SHORT_DESC_LENGTH,message:"The length of the synopsis must be within "+r.MIN_SHORT_DESC_LENGTH+" and "+r.MAX_SHORT_DESC_LENGTH+" characters"}}));getAdminLevel()>=PoggitConsts.AdminLevel.REVIEWER&&g.push(new m("official",f.fields.official,"Official?","submit2-official",D,function(){return{valid:!0}}));
g.push(G=new m("description",f.fields.description,"Description","submit2-description",H({cols:72,rows:15}),function(){var a=this.getValue().text;if(a.length<r.MIN_DESCRIPTION_LENGTH)return{valid:!1,message:"The description must be at least "+r.MIN_DESCRIPTION_LENGTH+" characters long"};for(var b=a=a.replace("\r\n","\n"),d=[f.repoInfo.name,f.buildInfo.projectName,f.pluginYml.name],h=!1,c=0;c<d.length;++c)if(b.startsWith("# "+d[c])||b.startsWith(d[c]+"\n===")){h=!0;break}if(h&&(1<b.countRegExp(/^[ \t]*===[ \t]*$/)||
0<b.countSubstr("\n# "))&&confirm('The plugin description starts with the plugin name as the header. Did you forget to delete it? The plugin description doesn\'t need to repeat the plugin name, because it\'s already in the plugin release page.\nSee https://poggit.pmmp.io/support/description-format for more information.\n\nClick "OK" to continue editing your description.\nClick "Cancel" to proceed.'))throw E;if((a=p(a))&&confirm("The plugin description contains "+a+'. Did you forget to delete it? The plugin description shouldn\'t display it.\nSee https://poggit.pmmp.io/support/description-format for more information.\n\nClick "OK" to continue editing your description.\nClick "Cancel" to proceed.'))throw E;
return{valid:!0}}));g.push("About this version");g.push(new m("version",f.fields.version,"Version","submit2-version",z({size:10,maxlength:16},function(a,b,d){var h=this;this.locked?"undefined"!==typeof d&&d.preventDefault():ajax("release.submit.validate.version",{data:{version:a,projectId:f.buildInfo.projectId},method:"POST",success:function(a){h.invalid=!a.ok;h.reactInput(a.message,a.ok?"form-input-good":"form-input-error")}})}),function(){return{valid:!this.invalid,message:"Invalid plugin version: "+
this.$getRow().find(".form-input-react").text()}},!0,"edit"===f.mode));g.push(new m("preRelease",f.fields.preRelease,"Pre-release?","submit2-prerelease",D,function(){return{valid:!0}}));"edit"===f.mode&&g.push(new m("outdated",f.fields.outdated,"Outdated?","submit2-outdated",D,function(){return{valid:!0}}));"object"===typeof f.fields.changelog&&g.push(new m("changelog",f.fields.changelog,"What's New","submit2-changelog",H({cols:72,rows:8}),function(){return{valid:this.getValue().text.length>=r.MIN_CHANGELOG_LENGTH,
message:"The changelog must be at least "+r.MIN_CHANGELOG_LENGTH+" characters long"}}));g.push("Help users find this plugin");g.push(new m("majorCategory",f.fields.majorCategory,"Major Category","submit2-majorcat",K(f.consts.categories,{},function(a){var b=$("#submit2-minorcats").find(".cbinput");b.removeClass("submit-cb-disabled").children(".submit-cb").prop("disabled",!1);b.filter(function(){var b=this.getElementsByClassName("submit-cb");console.assert(1===b.length);return Number(b[0].value)===
Number(a)}).addClass("submit-cb-disabled").find(".submit-cb").prop("disabled",!0)}),function(){return{valid:!0}}));g.push(new m("minorCategories",f.fields.minorCategories,"Minor Categories","submit2-minorcats",L(f.consts.categories),function(){return{valid:!0}}));g.push(new m("keywords",f.fields.keywords,"Keywords","submit2-keywords",z,function(){var a=this.getValue();if(a.split(" ").length>r.MAX_KEYWORD_COUNT)return{valid:!1,message:"Too many keywords! Only supply up to "+r.MAX_KEYWORD_COUNT+" keywords."};
for(var b=0;b<a.length;++b)if(a[b].length>r.MAX_KEYWORD_LENGTH)return{valid:!1,message:'The keyword "'+a[b]+'" is too long. Each keyword should not have more than '+r.MAX_KEYWORD_LENGTH+" characters."};return{valid:!0}}));g.push("About installation");g.push(new m("deps",f.fields.deps,"Dependencies","submit2-deps",M,function(){return{valid:!0}}));g.push(new m("requires",f.fields.reqrs,"Manual Setup","submit2-requires",N,function(){return{valid:!0}}));g.push(new m("spoons",f.fields.spoons,"Supported APIs",
"submit2-spoons",O,function(){return{valid:1<=this.getValue().length,message:"There must be at least one supported API version range!"}},!0,"edit"===f.mode&&0!==f.refRelease.state));g.push("Plugin association");g.push(new m("assocParent",f.fields.assocParent,"Associate Release of:","submit2-assoc-parent",P,function(){return{valid:!0}}));0<f.assocChildren.length&&g.push(new m("assocChildrenUpdates",f.fields.assocChildren,"Children Associate Releases","submit2-assoc-children-updates",I(f.assocChildren,
!0),function(){return{valid:!0}}));g.push("Other details");g.push(new m("license",f.fields.license,"License","submit2-license",Q,function(){return{valid:!0}}));g.push(new m("perms",f.fields.perms,"Permissions","submit2-perms",I(f.consts.perms,!0),function(){return{valid:!0}}));g.push(F=new m("authors",f.fields.authors,"Producers","submit2-authors",R,function(){return{valid:this.getValue().length>=F.type.minRows,message:"There must be at least 1 producer!"}}));t(G);setTimeout(v,500,F);var b=$(".form-table");
b.empty();for(var a=0;a<g.length;++a)g[a].constructor===String?$("<div class='form-subtitle'></div>").append($("<span></span>").text(g[a])).appendTo(b):g[a].constructor===m&&g[a].appendTo(b);for(a=0;a<g.length;++a)g[a].constructor===m&&g[a].setDefaults();$("#submit2-assoc-children-updates").find("input.submit-cb").prop("checked",!0);b.append($("<div class='form-row'></div>").append("<div class='form-key'>Icon</div>").append($("<div class='form-value'></div>").html(f.icon.html)).append($("<div class='form-icon-preview'></div>").append($("<img/>").attr("src",
null===f.icon.url?getRelativeRootPath()+"res/defaultPluginIcon2.png":f.icon.url))));a=$("<div class='submit-buttons'></div>");var d=null,h=null;"edit"!==f.mode?(d=null!==f.last?"Submit Update":"Submit Plugin",h="Save as Draft"):0===f.refRelease.state?(d=null!==f.last?"Submit Update from Draft":"Submit Plugin from Draft",h="Save Edit"):2===f.refRelease.state?(d="Save Edit",h="Restore to Draft"):d="Save Edit";null!==d&&a.append($("<span class='action-red'></span>").text(d).click(function(){k("submit")}));
null!==h&&a.append($("<span class='action-red'></span>").text(h).click(function(){k("draft")}));a.appendTo(b)}function p(b){for(var a=f.icon.url,d=/!\[[^\]]*\]\(([^)]+)\)/g,h;null!=(h=d.exec(b));){h=h[1];if(h.startsWith("https://poggit.pmmp.io/ci.badge/"))return"the Poggit-CI badge";if(h.startsWith("https://poggit.pmmp.io/ci.shield/"))return"the Poggit-CI shield";if(h===a||a.endsWith("/"+h.ulTrim("/")))return"the plugin icon"}return null}function k(b){var a=!1;$(".submit-deps-version").each(function(){"undefined"===
typeof $(this).attr("data-relid")&&(alert("You haven't selected the version in one of the dependencies yet!"),a=!0)});if(!a)if(0<$("#submit-assoc-parent-name").val().length&&"undefined"===typeof $("#submit-assoc-parent-version").attr("data-relid"))alert("You haven't selected the version for the associate release parent yet!");else{var d=$("#wait-spinner");d.modal();for(var h=0;h<g.length;++h)if(g[h].constructor===m&&!g[h].locked){var e=void 0;try{e=g[h].validator.call(g[h])}catch(J){if(J===E)return}if(!e.valid){d.modal("hide");
if("submit"===b){alert("Cannot submit due to a problem in "+g[h].name+":\n\n"+e.message);return}if(!confirm("Warning: This plugin cannot be submitted due to a problem in "+g[h].name+":\n\n"+e.message+"\n\nDo you still want to save this draft?"))return}}b={form:y(),action:b,submitFormToken:f.submitFormToken};ajax("submit.new.ajax",{method:"POST",data:JSON.stringify(b),success:function(a){a.status?window.location=a.link:(d.modal("hide"),alert(a.error))},error:function(a){d.modal("hide");a=JSON.parse(a.responseText);
alert(a.error)}})}}function l(b,a){if("object"===typeof a)for(var d in a)a.hasOwnProperty(d)&&("boolean"===typeof a[d]?b.prop(d,a[d]):b.attr(d,a[d]))}function t(b){ghApi("search/code?q="+encodeURIComponent("readme in:path repo:"+f.repoInfo.full_name),{},"GET",function(a){a=a.items;var d=f.buildInfo.path;a.sort(function(a,b){var h=a.path.substring(0,d.length)===d,e=b.path.substring(0,d.length)===d;return h&&e?Math.compare(a.path.length,b.path.length):h!==e?h?-1:1:a.path===a.name?-1:b.path===b.name?
1:a.path.localeCompare(b.path)});for(var h=b.$getRow(),e=0;e<a.length;++e){var c=h.find(".form-value-defaults"),u=$("<span class='action form-value-import'></span>");u.text("Import from "+a[e].path);u.click(function(a){return function(){$.get("https://raw.githubusercontent.com/"+f.repoInfo.full_name+"/"+f.repoInfo.default_branch+"/"+a.path,{},function(a){h.find(".submit-hybrid-content").val(a);h.find(".submit-hybrid-format").val("sm")})}}(a[e]));u.appendTo(c)}})}function v(b){var a=b.$getRow().find(".submit-tableentry-row");
a.each(function(){var b=$(this),h=b.find(".submit-authors-name");if(b.prop("data-changed")||b.prop("data-duplicated")){var e=b.find(".submit-authors-name-react"),c=h.val();b.prop("data-changed",!1).prop("data-duplicated",!1);var u=b.find(".submit-authors-avatar");u.attr("src",getRelativeRootPath()+"res/ghMark.png");e.removeClass("form-input-good form-input-error").html("&nbsp;");if(c.toLowerCase()===f.repoInfo.owner.login.toLowerCase())"User"===f.repoInfo.owner.type?e.addClass("form-input-error").html("&cross; Duplicated producer"):
e.addClass("form-input-error").html("&cross; Only users can be added as producers.");else if(1<a.find(".submit-authors-name").filter(function(){return this.value===c}).length)e.addClass("form-input-error").html("&cross; Duplicated producer"),b.prop("data-duplicated",!0);else if(/^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38}$/i.test(c)){var q=c.toLowerCase();b.attr("data-lock",q);ghApi("users/"+c,{},"GET",function(a){b.attr("data-lock")===q&&("undefined"!==typeof a.avatar_url?"User"!==a.type?e.addClass("form-input-error").html("&cross; Only users can be added as producers. @"+
c+" is an "+a.type.toLowerCase()+"."):(u.attr("src",a.avatar_url),e.addClass("form-input-good").html("&checkmark; Found user"+(null!==a.name?" ("+a.name+")":"")),b.attr("data-uid",a.id)):e.addClass("form-input-error").html("&cross; @"+c+" was not registered on GitHub!"))})}else e.addClass("form-input-error").html("&cross; Invalid username")}});setTimeout(v,500,b)}function y(){for(var b={},a=0;a<g.length;++a)if(g[a].constructor===m&&!g[a].locked){var d=g[a].getValue();null!==d&&(b[g[a].submitKey]=
d)}return b}function m(b,a,d,h,e,c,u,q){"function"===typeof e&&(e=e());console.assert("function"===typeof e.appender);console.assert("function"===typeof e.getter);console.assert("function"===typeof e.setter);console.assert("boolean"===typeof e.afterRemarks);console.assert("function"===typeof c);this.type=e;this.validator=c;this.id=h;this.submitKey=b;this.name=d;this.rem=a.remarks;this.refDefault=a.refDefault;this.srcDefault=a.srcDefault;this.prefSrc="edit"===f.mode?!1:"undefined"===typeof u?!1:u;
this.locked="undefined"===typeof q?!1:q;this.isThisFirstEntry=this.constructor.isNextFirstEntry;this.constructor.isNextFirstEntry=!1}function z(b,a){return{appender:function(d){var h=$("<input/>");h.addClass("submit-textinput");this.locked&&h.prop("disabled",!0);l(h,b);if("function"===typeof a){var e=this;h.on("input",function(b){b=a.call(e,h.val(),h,b);"string"===typeof b&&h.val(b)})}h.appendTo(d)},getter:function(){return this.$getRow().find(".submit-textinput").val()},setter:function(b){var d=
this.$getRow().find(".submit-textinput");d.val(b);"function"===typeof a&&a.call(this,b,d,void 0)},afterRemarks:!1}}function D(b){return{appender:function(a){var d=$("<input type='checkbox'/>");d.addClass("submit-checkinput");this.locked&&d.prop("disabled",!0);l(d,b);d.appendTo(a)},getter:function(){return this.$getRow().find(".submit-checkinput").prop("checked")},setter:function(a){this.$getRow().find(".submit-checkinput").prop("checked",a)},afterRemarks:!1}}function H(b){return{appender:function(a){var d=
$("<textarea class='submit-hybrid-content'></textarea>");this.locked&&d.prop("disabled",!0);l(d,b);d.appendTo(a);d="https://github.com/"+f.repoInfo.full_name+"/tree/"+f.buildInfo.sha.substring(0,7)+"/";$("<div></div>").append("<label style='padding: 5px;'>Format:</label>").append($("<select class='submit-hybrid-format' style='display: inline-flex;'></select>").append($("<option value='txt'>Plain Text (You may indent with spaces)</option>")).append($("<option value='sm'></option>").text("Standard Markdown (rendered like README, links relative to "+
d+")")).append($("<option value='gfm'></option>").text("GFM (rendered like issue comments, links relative to "+d+")"))).appendTo(a)},getter:function(){var a=this.$getRow();return{text:a.find(".submit-hybrid-content").val(),type:a.find(".submit-hybrid-format").val()}},setter:function(a){var b=this.$getRow();b.find(".submit-hybrid-content").val(a.text);b.find(".submit-hybrid-format").val(a.type)},noDefaults:function(){this.$getRow().find(".submit-hybrid-format").val("sm")},afterRemarks:!1}}function Q(){var b=
{},a=function(){var a=$("<div id='licenseViewDialog'></div>"),b=$("<div id='licenseDialogLoading'></div>").css("font-size","x-large").text("Loading..."),e=$("<div id='licenseDialogInner' autofocus></div>").css("display","none");b.appendTo(a);e.appendTo(a);var c=$("<p id='licenseDescription'></p>");c.appendTo(e);var f=$("<div id='licenseMetaDiv'></div>").css("display","flex"),q={permissions:"Permissions",conditions:"Conditions",limitations:"Limitations"},k={};for(x in q)if(q.hasOwnProperty(x)){var g=
$("<div class='license-metadata'></div>");$("<div></div>").css("font-weight","bold").text(q[x]).appendTo(g);var l=$("<ul></ul>");k[x]=l;l.appendTo(g);g.appendTo(f)}f.appendTo(e);var x=$("<pre></pre>");x.appendTo(e);a.dialog({autoOpen:!1,width:Math.min(.8*window.innerWidth,600),modal:!0,height:.8*window.innerHeight,position:modalPosition,open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#licenseViewDialog").dialog("close")})}});return{dialogDiv:a,innerLoadingDiv:b,innerDialogDiv:e,
ulNames:q,ulList:f,description:c,metadataUls:k,bodyPre:x}};return{appender:function(d){var h=this;this.ready=!1;var e=$("<select></select>").addClass("submit-license-type").append($("<optgroup label='Special'></optgroup>").append($("<option></option>").text("No License").attr("value","none")).append($("<option></option>").text("Custom License").attr("value","custom")));var c=$("<optgroup></optgroup>").attr("label","Featured");c.appendTo(e);var f=$("<optgroup></optgroup>").attr("label","Others");f.appendTo(e);
e.change(function(){q.css("display","custom"===e.val()?"block":"none");var a="none"===e.val()||"custom"===e.val();k.hasClass("disabled")!==a&&(a?k.addClass("disabled"):k.removeClass("disabled"))}).appendTo(d);var q=$("<textarea></textarea>").addClass("submit-license-custom").css("display","none").appendTo(d);var g=a();var k=$("<span></span>").addClass("action disabled").attr("id","licenseView").text("View license details").click(function(){var a=e.val();void 0!==b[a]&&(a=b[a],g.dialogDiv.dialog("option",
"title",a.name),g.dialogDiv.dialog("open"),g.innerLoadingDiv.css("display","block"),g.innerDialogDiv.css("display","none"),ghApi("licenses/"+a.key,{},"GET",function(a){g.description.text(a.description);for(var b in g.ulNames){var d=g.metadataUls[b],h=a[b];d.empty();for(var e=0;e<h.length;++e)$("<li></li>").text(h[e]).appendTo(d)}g.bodyPre.text(a.body);g.innerLoadingDiv.css("display","none");g.innerDialogDiv.css("display","block")},void 0,"Accept: application/vnd.github.drax-preview+json"))}).appendTo(d);
ghApi("licenses",{},"GET",function(a){a.sort(function(a,b){return a.name.localeCompare(b.name)});for(var d=0;d<a.length;d++){var g=$("<option></option>");g.attr("value",a[d].key);g.attr("data-url",a[d].url);g.text(a[d].name);b[a[d].key]=a[d];"undefined"!==typeof h.wannaSet&&a[d].key===h.wannaSet.type&&(g.prop("selected",!0),k.removeClass("disabled"));g.appendTo(a[d].featured?c:f)}h.ready=!0;"undefined"!==typeof h.wannaSet&&e.val(h.wannaSet.type)},void 0,"Accept: application/vnd.github.drax-preview+json")},
getter:function(){if(!this.ready)return this.wannaSet;var a=this.$getRow(),b=a.find(".submit-license-type").val();return{type:b,custom:"custom"===b?a.find(".submit-license-custom").val():null}},setter:function(a){if(this.ready||"custom"===a.type||"none"===a.type){var b=this.$getRow();b.find(".submit-license-type").val(a.type);"custom"===a.type&&b.find(".submit-license-custom").val(a.custom)}else this.wannaSet=a},afterRemarks:!1}}function K(b,a,d){return{appender:function(h){var e=$("<select></select>");
e.addClass("submit-selinput");this.locked&&e.prop("disabled",!0);for(var c in b)if(b.hasOwnProperty(c)){var f=$("<option></option>");f.attr("value",c);f.text(b[c]);f.appendTo(e)}l(e,a);if("function"===typeof d){var g=this;e.change(function(a){a=d.call(g,e.val(),e,a);"string"===typeof a&&e.val(a)})}e.appendTo(h)},getter:function(){return this.$getRow().find(".submit-selinput").val()},setter:function(a){this.$getRow().find(".submit-selinput").val(a);"function"===typeof d&&d.call(this,a)},noDefaults:function(){"function"===
typeof d&&d.call(this,this.$getRow().find(".submit-selinput").val())},afterRemarks:!1}}function L(b,a,d,h){return{appender:function(e){var c=$("<div></div>");c.addClass("submit-cbgrp-compact");for(var f in b)if(b.hasOwnProperty(f)){var g=$("<div class='cbinput'></div>"),k=$("<input type='checkbox'/>");k.addClass("submit-cb");k.attr("value",f);k.appendTo(g);g.append(b[f]);g.appendTo(c);this.locked&&k.prop("disabled",!0);l(k,a);l(g,d)}l(c,h);c.appendTo(e)},getter:function(){return this.$getRow().find(".submit-cb:checked").map(function(){return this.value}).get()},
setter:function(a){this.$getRow().find(".submit-cb").not(".submit-cb-disabled").each(function(){this.checked=a.map(String).includes(this.value)})},afterRemarks:!1}}function I(b,a){return{afterRemarks:a,appender:function(a){var d=$("<div></div>");d.addClass("submit-expcb-wrapper");for(var e in b)if(b.hasOwnProperty(e)){var c=$("<div></div>").addClass("submit-expcb-row"),f=$("<div></div>").addClass("cbinput"),g=$("<input type='checkbox'/>").addClass("submit-cb").attr("value",e);g.appendTo(f);this.locked&&
g.prop("disabled",!0);f.append("<div class='cblabel'>"+b[e].name+"</div>");f.appendTo(c);$("<div></div>").addClass("remark").text(b[e].description).appendTo(c);c.appendTo(d)}d.appendTo(a)},getter:function(){return this.$getRow().find(".submit-cb:checked").map(function(){return this.value}).get()},setter:function(a){this.$getRow().find(".submit-cb").not(".submit-cb-disabled").each(function(){this.checked=a.map(String).includes(this.value)})}}}function A(b,a,d,c,e){function h(b,d){var c=$("<tr class='submit-tableentry-row'></tr>");
a(c,d);d.locked||(d=$("<td></td>"),$("<span class='action-red'>&cross;</span>").click(function(){b.find(".submit-tableentry-row").length<=e?alert("There must be at least "+e+" rows!"):c.remove()}).appendTo(d),d.appendTo(c));c.appendTo(b);return c}"undefined"===typeof e&&(e=0);return{appender:function(a){var d=$("<table class='submit-tableentry-table'></table>");b(d);for(var c=0;c<e;++c)h(d,this);d.appendTo(a);this.locked||$("<span class='action'>&plus;</span>").click(function(){h(d,this)}).appendTo(a)},
getter:function(){var a=[];this.$getRow().find(".submit-tableentry-row").each(function(){var b=d($(this));null!==b&&a.push(b)});return a},setter:function(a){console.assert(a.constructor===Array,"values passed for "+this.name+" is not array but ",a);var b=this.$getRow().find(".submit-tableentry-table");b.children(".submit-tableentry-row").remove();for(var d=0;d<a.length;++d){var e=h(b,this);c(e,a[d])}},minRows:e,afterRemarks:!1}}function R(){return A(function(b){$("<tr class='submit-authors-row-default'></tr>").append($("<th>GitHub username</th>").css("width",
"200px")).append("<th>Type</th>").appendTo(b);var a=f.repoInfo.owner;"User"===a.type&&$("<tr></tr>").append($("<td class='submit-authors-user-cell'></td>").append($("<img height='28' class=submit-authors-avatar'/>").attr("src",a.avatar_url)).append($("<input class='submit-authors-name' size='15' disabled/>").val(a.login)).append($("<div class='submit-authors-name-react form-input-good'>The repo owner is an implicit collaborator</div>"))).append($("<td class='submit-authors-level-cell'></td>").append("<select class='submit-authors-level' disabled><option selected>Collaborator</option></select>")).appendTo(b)},
function(b){$("<td class='submit-authors-user-cell'></td>").append($("<img height='28' class='submit-authors-avatar'/>").attr("src",getRelativeRootPath()+"res/ghMark.png")).append($("<input class='submit-authors-name' size='15'/>").on("input",function(){b.prop("data-changed",!0);b.removeAttr("data-uid")})).append($("<div class='submit-authors-name-react'>&nbsp;</div>")).appendTo(b);var a=$("<select class='submit-authors-level'></select>"),d;for(d in f.consts.authors)if(f.consts.authors.hasOwnProperty(d)){var c=
f.consts.authors[d];$("<option></option>").attr("value",d).text(c).appendTo(a)}$("<td class='submit-authors-level-cell'></td>").append(a).appendTo(b)},function(b){return"undefined"===typeof b.attr("data-uid")?null:{uid:b.attr("data-uid"),name:b.find(".submit-authors-name").val(),level:b.find(".submit-authors-level").val()}},function(b,a){b.attr("data-uid",a.uid);b.prop("data-changed",!0);b.find(".submit-authors-name").val(a.name);b.find(".submit-authors-level").val(a.level)},"Organization"===f.repoInfo.owner.type?
1:0)}function O(){function b(a){for(var b in f.consts.spoons)f.consts.spoons.hasOwnProperty(b)&&$("<option></option>").addClass("submit-spoons-option").attr("value",b).text(b).appendTo(a)}return A($.noop,function(a,d){var c=$("<select class='submit-spoons-start'></select>"),e=$("<select class='submit-spoons-end'></select>");d.locked&&(c.prop("disabled",!0),e.prop("disabled",!0));var g=f.consts.spoons,k=Object.sizeof(g),l=Object.keysToArray(g),m=Object.valuesToArray(g);b(c);b(e);var n=c.children("option"),
p=e.children("option");c.change(function(){var a=l.indexOf(this.value),b=e.val(),d=l.indexOf(b);p.prop("disabled",!1);p.slice(0,a).prop("disabled",!0);for(var c=a;c<k;++c)k===c+1||m[c+1].incompatible?p.eq(c).prop("disabled",!1):p.eq(c).prop("disabled",!0);d<a&&(d=a);if(d+1<g.length&&!m[d+1].incompatible){for(a=d+1;a<k;++a)if(a+1===k||m[a+1].incompatible){d=a;break}console.assert(d===a);b=l[b];e.val(b);e.change()}});e.change(function(){var a=l.indexOf(c.val()),b=l.indexOf(e.val());n.slice(0,b+1).prop("disabled",
!1);n.slice(b+1).prop("disabled",!0);a>b&&c.val(l[b])});c.val(f.consts.promotedSpoon);e.val(Object.keysToArray(f.consts.spoons).slice(-1)[0]);c.wrap("<td></td>").parent().appendTo(a);a.append("<td>&mdash;</td>");e.wrap("<td></td>").parent().appendTo(a)},function(a){return[a.find(".submit-spoons-start").val(),a.find(".submit-spoons-end").val()]},function(a,b){var d=a.find(".submit-spoons-start").val(b[0]);a=a.find(".submit-spoons-end").val(b[1]);d.change();a.change()},1)}function N(){return A(function(b){$("<tr></tr>").append($("<th>Required?</th>").css("width",
"150px")).append($("<th>Type</th>").css("width","250px")).append($("<th>Details</th>").css("width","500px")).appendTo(b)},function(b){var a=$("<select class='submit-requires-type'></select>"),d=$("<input class='submit-requires-details'/>").attr("size",50),c;for(c in f.consts.reqrs)if(f.consts.reqrs.hasOwnProperty(c)){var e=f.consts.reqrs[c].name;$("<option></option>").attr("value",c).text(e).appendTo(a)}a.change(function(){d.attr("placeholder",f.consts.reqrs[this.value].details)}).change();b.append($("<select class='submit-requires-isrequire'></select>").append("<option value='require'>Requirement</option>").append("<option value='enhance'>Enhancement</option>").wrap("<td></td>").parent()).append(a.wrap("<td></td>").parent()).append(d.wrap("<td></td>").parent())},
function(b){return{type:b.find(".submit-requires-type").val(),details:b.find(".submit-requires-details").val(),isRequire:"require"===b.find(".submit-requires-isrequire").val()}},function(b,a){b.find(".submit-requires-type").val(a.type).change();b.find(".submit-requires-details").val(a.details);b.find(".submit-requires-isrequire").val(a.isRequire?"require":"enhance")})}function M(){return A(function(b){$("<tr></tr>").append($("<th>Required?</th>").css("width","100px")).append($("<th>Plugin Name</th>").css("width",
"200px")).append($("<th>Version</th>")).appendTo(b)},function(b){var a=$("<input class='submit-deps-name' size='15'/>"),d=$("<span class='submit-deps-version action'>Choose a version...</span>");a.change(function(){d.text("Choose a version").removeAttr("data-relid")});d.click(function(){B=d;var b=w=Math.random(),c=a.val();n.dialog.dialog("option","title",'Choose a version of "'+a.val()+'"');n.loading.css("display","block");n.error.css("display","none");n.inner.css("display","none");n.dialog.dialog("open");
ajax("submit.deps.getversions",{data:{name:c,owner:"false"},success:function(a){if(b===w)if(0===Object.sizeof(a))n.loading.css("display","none"),n.error.text("There aren't any submitted (and not rejected) plugins on Poggit called "+c).css("display","block");else{n.loading.css("display","none");C=a;n.table.find("tr.submit-deps-version-select-row").remove();n.table.find("tr.submit-deps-version-header").remove();for(var d in a)if(a.hasOwnProperty(d)){var e=$("<span></span>").attr("data-timestamp",a[d].submitTime);
timeTextFunc.call(e.get()[0]);n.table.prepend($("<tr></tr>").addClass("submit-deps-version-select-row").append($("<td></td>").append($("<input type='radio'/>").addClass("submit-dep-dialog-version-radio").attr("name",w).attr("data-value",d).prop("checked",!0)).append($("<label></label>").text(a[d].version))).append($("<td></td>").append($("<input type='checkbox' disabled/>").prop("checked",a[d].preRelease))).append($("<td></td>").append(a[d].stateName)).append($("<td></td>").append(e)))}n.table.prepend("<tr class='submit-deps-version-header'><th>Version</th><th>Pre-release</th><th>Status</th><th>Submitted</th></tr>");
n.inner.css("display","block")}}})});b.append($("<select class='submit-deps-required'></select>").append("<option value='required'>Required</option>").append("<option value='optional'>Optional</option>").wrap("<td></td>").parent()).append(a.wrap("<td></td>").parent()).append(d.wrap("<td></td>").parent())},function(b){var a=b.find("span.submit-deps-version");return"undefined"===typeof a.attr("data-relid")?null:{name:b.find("input.submit-deps-name").val(),version:a.attr("data-version"),depRelId:Number(a.attr("data-relid")),
required:"required"===b.find("select.submit-deps-required").val()}},function(b,a){b.find("input.submit-deps-name").val(a.name);b.find("span.submit-deps-version").text("Change: v"+a.version).attr("data-version",a.version).attr("data-relid",a.depRelId);b.find("select.submit-deps-required").val(a.required?"required":"optional")})}function P(){return{afterRemarks:!0,appender:function(b){var a=$("<input id='submit-assoc-parent-name' size='15' placeholder='Plugin Name'/>"),d=$("<span id='submit-assoc-parent-version' class='action'>Choose a version...</span>");
a.change(function(){d.text("Choose a version").removeAttr("data-relid")});d.click(function(){a.css("border","");if(3>a.val().length)a.css("border","1px solid red");else{var b=w=Math.random();B=d;var c=a.val();n.dialog.dialog("option","title",'Choose a version of "'+a.val()+'"');n.loading.css("display","block");n.error.css("display","none");n.inner.css("display","none");n.dialog.dialog("open");ajax("submit.deps.getversions",{data:{name:c,owner:"true"},success:function(a){if(b===w)if(0===Object.sizeof(a))n.loading.css("display",
"none"),n.error.text("You do not own any submitted (and not rejected) plugins on Poggit called "+c).css("display","block");else{n.loading.css("display","none");C=a;n.table.find("tr.submit-deps-version-select-row").remove();n.table.find("tr.submit-deps-version-header").remove();for(var d in a)if(a.hasOwnProperty(d)){var e=$("<span></span>").attr("data-timestamp",a[d].submitTime);timeTextFunc.call(e.get()[0]);n.table.prepend($("<tr></tr>").addClass("submit-deps-version-select-row").append($("<td></td>").append($("<input type='radio'/>").addClass("submit-dep-dialog-version-radio").attr("name",
w).attr("data-value",d).prop("checked",!0)).append($("<label></label>").text(a[d].version))).append($("<td></td>").append($("<input type='checkbox' disabled/>").prop("checked",a[d].preRelease))).append($("<td></td>").append(a[d].stateName)).append($("<td></td>").append(e)))}n.table.prepend("<tr class='submit-deps-version-header'><th>Version</th><th>Pre-release</th><th>Status</th><th>Submitted</th></tr>");n.inner.css("display","block")}}})}});$("<div></div>").css("display","flex").append(a).append(d).appendTo(b)},
getter:function(){var b=this.$getRow().find("#submit-assoc-parent-version");return"undefined"===typeof b.attr("data-relid")?null:{releaseId:Number(b.attr("data-relid")),name:this.$getRow().find("submit-assoc-parent-name").val(),version:b.attr("data-version")}},setter:function(b){null!==b&&null!==b.version&&($("#submit-assoc-parent-version").text("Change: v"+b.version).attr("data-version",b.version).attr("data-relid",b.releaseId),$("#submit-assoc-parent-name").val(b.name))}}}var r=PoggitConsts.Config,
E={},g=[],G,F,f;ajax("submit.form",{data:{query:window.location.pathname.substr(getRelativeRootPath().length)},success:function(b){if("error/redirect"===b.action)window.location.replace(b.target),null!==b.message&&alert(b.message);else{var a=$("#body");if("error/bad_query"===b.action)a.html("<h1>400 Bad Request</h1>"),b.text?$("<p></p>").text(b.message).appendTo(a):a.append("<p>"+b.message+"</p>");else if("error/access_denied"===b.action)a.html("<h1>401 Access Denied</h1>"),b.text?$("<p></p>").text("Details: "+
b.message).appendTo(a):a.append("<p>Details:&nbsp;"+b.message+"</p>");else if("error/not_found"===b.action)a.html("<h1>404 Not Found</h1>"),b.text?$("<p></p>").text(b.message).appendTo(a):a.append("<p>"+b.message+"</p>");else if("success"!==b.action)alert("The server returns an unknown result! Please copy (or screenshot) the following data:\n\n"+JSON.stringify(b));else{f=b.submitData;a=b.submitData.last;document.title=b.title;document.getElementById("submit-title-action").innerHTML=b.actionTitle;
generateGhLink(b.treeLink).appendTo(document.getElementById("submit-title-gh"));b=f.args.slice(0,3).join("/");$("<a class='colorless-link' target='_blank'></a>").attr("href",getRelativeRootPath()+"ci/"+b).append($("<img/>").attr("src",getRelativeRootPath()+"ci.badge/"+b+"?build="+f.args[3])).appendTo(document.getElementById("submit-title-badge"));if(null!=a){var d=document.getElementById("submit-intro-last-name");$("<h5></h5>").text("Updates v"+a.version).append($("<sub></sub>").append($("<a class='colorless-link' target='_blank'></a>").attr("href",
getRelativeRootPath()+"ci/"+b+"/"+a.internal).text("Dev Build #"+a.internal+" (&"+a.buildId+")"))).appendTo(d);d.style.display="block"}c()}}},error:function(b){b=b.getResponseHeader("X-Poggit-Request-ID");window.location.replace(getRelativeRootPath()+"500ise.template?id="+b)}});m.isNextFirstEntry=!0;m.prototype.$getRow=function(){return $(document.getElementById(this.id))};m.prototype.appendTo=function(b){var a=$("<div class='form-row'></div>").attr("id",this.id);$("<div class='form-key'></div>").text(this.name).appendTo(a);
var d=$("<span></span>").addClass("explain").html(this.rem),c=$("<div class='form-value'></div>");this.type.afterRemarks?(d.addClass("explain-before-input").appendTo(c),this.type.appender.call(this,c)):(this.type.appender.call(this,c),d.addClass("explain-after-input").appendTo(c));c.appendTo(a);$("<div class='form-input-react'></div>").appendTo(c);var e=this;if(!this.locked){d=$("<div class='form-value-defaults'></div>");var g=c=null;null!==this.refDefault&&(c=$("<span class='action form-value-import'></span>").text("edit"===
f.mode?"Reset":this.isThisFirstEntry?"Copy from last release":"Copy"),c.click(function(){e.type.setter.call(e,e.refDefault)}));null!==this.srcDefault&&(g=$("<span class='action form-value-import'></span>").text(this.isThisFirstEntry?"Detect from code":"Detect"),g.click(function(){e.type.setter.call(e,e.srcDefault)}));this.prefSrc?(null!==g&&g.appendTo(d),null!==c&&c.appendTo(d)):(null!==c&&c.appendTo(d),null!==g&&g.appendTo(d));d.appendTo(a)}a.appendTo(b)};m.prototype.setDefaults=function(){if(this.prefSrc)if(null!==
this.srcDefault)var b=this.srcDefault;else null!==this.refDefault&&(b=this.refDefault);else null!==this.refDefault?b=this.refDefault:null!==this.srcDefault&&(b=this.srcDefault);void 0!==b?this.type.setter.call(this,b):"function"===typeof this.type.noDefaults&&this.type.noDefaults.call(this)};m.prototype.reactInput=function(b,a){var d=this.$getRow().find(".form-input-react");d.html(b);if("object"===typeof this.classes&&this.classes.constructor===Array)for(b=0;b<this.classes.length;++b)d.removeClass(this.classes[b]);
this.classes=[];if("string"===typeof a)this.classes.push(a),d.addClass(a);else if("object"===typeof a&&a.constructor===Array)for(b=0;b<a.length;++b)this.classes.push(a[b]),d.addClass(a[b])};m.prototype.getValue=function(){return this.locked?null:this.type.getter.call(this)};m.prototype.isValid=function(){return this.validator.call(this)};var B,w,C,n=function(){var b=$("<div id='depSelectDialog'></div>"),a=$("<div></div>").css("font-size","x-large").text("Loading versions..."),d=$("<div></div>").addClass("fallback-error"),
c=$("<div></div>");c.append("<p>Select the <strong>recommended</strong> version of the dependency plugin, usually the <em>latest</em> version. You don't need to select older versions; if you want to, mention it in the Description.</p>");c.append("<p>Keep in mind that the state of your plugin will never be higher than the state of your dependencies (except Featured). For example, if your plugin depends on a release that has not been approved yet, your plugin won't get approved either before the dependency release gets approved.</p>");
var e=$("<table></table>");e.appendTo(c);b.append(a).append(d).append(c);b.dialog({autoOpen:!1,width:Math.min(.8*window.innerWidth,600),modal:!0,height:.8*window.innerHeight,position:modalPosition,buttons:{Select:function(){var a=$("input.submit-dep-dialog-version-radio:checked").attr("data-value"),b=C[a].version;B.text("Change: v"+b).attr("data-relid",a).attr("data-version",b);$(this).dialog("close");C=w=B=void 0}},open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#depSelectDialog").dialog("close")})}});
return{dialog:b,loading:a,error:d,inner:c,table:e}}()});
