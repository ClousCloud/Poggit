var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,c,a){b instanceof String&&(b=String(b));for(var d=b.length,e=0;e<d;e++){var n=b[e];if(c.call(a,n,e,b))return{i:e,v:n}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,a){b!=Array.prototype&&b!=Object.prototype&&(b[c]=a.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,c,a,d){if(c){a=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var e=b[d];e in a||(a[e]={});a=a[e]}b=b[b.length-1];d=a[b];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");var maxRows=30;
function initOrg(b,c){var a=$("<div id='togglewrapper' class='togglewrapper'></div>");a.html("<p>Loading repos...</p>");a.attr("data-name",b);c||a.attr("data-opened","true");var d=toggleFunc(a);ghApi((c?"orgs":"users")+"/"+b+"/repos",{},"GET",function(a){var c=$("<table></table>");c.css("width","100%");for(var e=0;e<a.length;e++){var k=a[e],f="undefined"!==typeof briefEnabledRepos[k.id]?briefEnabledRepos[k.id]:null,l=$("<tr></tr>"),h=$("<td></td>"),g=$("<a></a>");g.text(k.name.substr(0,14)+(14<k.name.length?
"...":""));g.attr("href",getRelativeRootPath()+"ci/"+b+"/"+k.name);g.appendTo(h);h.append(generateGhLink("https://github.com/"+b+"/"+k.name));h.appendTo(l);h=$("<td id=prj-"+k.id+"></td>");null!==f&&f.projectsCount&&h.append(f.projectsCount);h.appendTo(l);h=$("<td></td>");g=$("<div class='toggle toggle-light' id=btn-"+k.id+"></div>");g.css("float","right");g.text(null===f||0===f.projectsCount?"Enable":"Disable");g.toggles({drag:!0,click:!0,text:{on:"ON",off:"OFF"},animate:250,easing:"swing",checkbox:null,
clicker:null,type:"compact"});g.toggles(!(null===f||0===f.projectsCount));g.toggleClass("disabled",!0);g.click(function(b,a){return function(){var c=$("#enableRepoBuilds");c.data("repoId",a.id);var e=null!==b&&0===b.projectsCount,d=e?"Enable":"Disable",f="auto";c.data("target",e?"true":"false");e?(loadToggleDetails(c,a),$("#confirm").attr("disabled",!0)):(f="300px",c.find("#detailLoader").text("Click Confirm to Disable Poggit-CI for "+a.name),$("#confirm").attr("disabled",!1));c.dialog({title:d+" Poggit-CI",
width:f,height:"auto",position:modalPosition});$(".ui-dialog-titlebar button:contains('Close')").prop("title","");c.dialog("open")}}(f,k));g.appendTo(h);h.appendTo(l);l.appendTo(c)}a=$(d);a.empty();c.appendTo(a)});return a}
function loadToggleDetails(b,c){var a=b.find("#detailLoader");a.text("Loading details...");b=b.dialog("option","buttons");for(var d,e=0;e<b.length;e++){var n=b[e];if("confirm"===n.id){d=n;break}}console.assert("object"===typeof d);ajax("build.scanRepoProjects",{data:{repoId:c.id},success:function(b){b=b.yaml;var e=(b.split(/\r\n|\r|\n/).length<maxRows?b.split(/\r\n|\r|\n/).length:maxRows)-1,d=$("<div class='pluginname'><h3>"+c.name+"</h3></div>");a.empty();d.appendTo(a);d=$("<div class='cbinput'></div>");
var l=$('<input type="checkbox" checked id="manifestEditConfirm">');l.change(function(){document.getElementById("selectManifestFile").disabled=!this.checked;document.getElementById("inputManifestContent").disabled=!this.checked});l.appendTo(d);d.append("Commit default .poggit.yml to the repo");d.appendTo(a);d=$("<p></p>");d.text("After Poggit-CI is enabled for this repo, a manifest file will be created at: ");$("<select id='selectManifestFile'><option value='.poggit.yml' selected>.poggit.yml</option></select>").appendTo(d);
d.appendTo(a);d=$("<div class='manifestarea'>Content of the manifest:<br/></div>");e=$("<textarea id='inputManifestContent' rows='"+e+"'></textarea>");e.text(b);e.appendTo(d);d.appendTo(a);$("#enableRepoBuilds").dialog({position:{my:"center top",at:"center top+100",of:window}});$("#confirm").attr("disabled",!1)},method:"POST"})}
function confirmRepoBuilds(b,c){var a={repoId:c.data("repoId"),enabled:c.data("target")},d;"true"===a.enabled&&document.getElementById("manifestEditConfirm").checked&&(d=c.find("#selectManifestFile"))&&(a.manifestFile=d.val(),a.manifestContent=c.find("#inputManifestContent").val());ajax("ajax.toggleRepo",{data:a,method:"POST",success:function(a){a.enabled?(briefEnabledRepos[a.repoId].projectsCount=a.projectscount,$("#prj-"+a.repoId).text(briefEnabledRepos[a.repoId].projectsCount),$(".ajaxpane").prepend(a.panelhtml),
$("#detailLoader").empty()):($("#repo-"+a.repoId).remove(),briefEnabledRepos[a.repoId].projectsCount=0,$("#prj-"+a.repoId).text(briefEnabledRepos[a.repoId].projectsCount));b.dialog("close");$("#btn-"+a.repoId).toggles(a.enabled);$("#confirm").attr("disabled",!1)}})}function startToggleOrgs(){var b=$("#toggle-orgs");0!==b.length&&(b.empty(),initOrg(getLoginName(),!1).appendTo(b),ghApi("user/orgs",{},"GET",function(c){for(var a=0;a<c.length;a++)initOrg(c[a].login,!0).appendTo(b)}))}
$(function(){var b=$("#inputSearch"),c=$("#inputUser"),a=$("#inputRepo"),d=$("#inputProject"),e=$("#inputBuild"),n=$("#gotoRecent"),t=$("#gotoAdmin"),k=$("#gotoSelf"),f=$("#gotoSearch"),l=$("#gotoUser"),h=$("#gotoRepo"),g=$("#gotoProject"),p=$("#gotoBuild"),m=function(){var b=!c.val().trim(),f=!(c.val().trim()&&a.val().trim()),k=!(c.val().trim()&&a.val().trim()&&d.val().trim()),m=!(c.val().trim()&&a.val().trim()&&d.val().trim()&&e.val().trim());l.hasClass("disabled")!==b&&l.toggleClass("disabled");
h.hasClass("disabled")!==f&&h.toggleClass("disabled");g.hasClass("disabled")!==k&&g.toggleClass("disabled");p.hasClass("disabled")!==m&&p.toggleClass("disabled")};if(""!=window.location.hash){var q=$("a[name="+window.location.hash.substring(1)+"]").parent().offset();"undefined"!==typeof q&&$("html, body").animate({scrollTop:q.top},300)}c.keydown(function(){setTimeout(m,50)});c.change(m);c.keyup(function(a){13==a.keyCode&&l.click()});b.keydown(function(){setTimeout(m,50)});b.change(m);b.keyup(function(a){13==
a.keyCode&&f.click()});a.keydown(function(){setTimeout(m,50)});a.change(m);a.keyup(function(a){13==a.keyCode&&h.click()});d.keydown(function(){setTimeout(m,50)});d.change(m);d.keyup(function(a){13==a.keyCode&&g.click()});e.keydown(function(){setTimeout(m,50)});e.change(m);e.keyup(function(a){13==a.keyCode&&p.click()});k.click(function(){window.location=getRelativeRootPath()+"ci/"+getLoginName()});t.click(function(){window.location=getRelativeRootPath()+"ci"});n.click(function(){window.location=getRelativeRootPath()+
"ci/recent"});f.click(function(){var a=$("#searchresults");if(""===b.val())a.empty(),a.attr("hidden",!0);else{a.text("Loading Search Results...");var c={search:b.val()};ajax("search.ajax",{data:c,method:"POST",success:function(b){a.empty();a.html(b.html);a.attr("hidden",!1);$("#inputSearch").val("")},error:function(a,b,c){alert(c)}})}});l.click(function(){$(this).hasClass("disabled")?alert("Please fill in the required fields"):window.location=getRelativeRootPath()+"ci/"+c.val()});h.click(function(){$(this).hasClass("disabled")?
alert("Please fill in the required fields"):window.location=getRelativeRootPath()+"ci/"+c.val()+"/"+a.val()});g.click(function(){$(this).hasClass("disabled")?alert("Please fill in the required fields"):window.location=getRelativeRootPath()+"ci/"+c.val()+"/"+a.val()+"/"+d.val()});p.click(function(){$(this).hasClass("disabled")?alert("Please fill in the required fields"):window.location=getRelativeRootPath()+"ci/"+c.val()+"/"+a.val()+"/"+d.val()+"/"+$("#inputBuildClass").val()+":"+e.val()});var r=$("#enableRepoBuilds");
startToggleOrgs();r.dialog({autoOpen:!1,dialogClass:"no-close",closeOnEscape:!0,close:function(a){a.originalEvent&&$("#detailLoader").empty()},buttons:[{id:"confirm",text:"Confirm",click:function(){$("#confirm").attr("disabled",!0);confirmRepoBuilds($(this),r)}}],modal:!0});16<$("#recentBuilds > div").length&&"on"===getParameterByName("usePages",!1!==sessionData.opts.usePages?"on":"off")&&$("#recentBuilds").paginate({perPage:16,scope:$("div")});12<$("#repolistbuildwrapper > div").length&&"on"===getParameterByName("usePages",
!1!==sessionData.opts.usePages?"on":"off")&&$("#repolistbuildwrapper").paginate({perPage:12,scope:$("div")})});function testWebhook(b,c){ajax("ci.webhookTest",{data:{owner:b,name:c},success:function(a){console.log(a)}})}function promptDownloadResource(b,c){c=prompt("Filename to download with:",c);null!==c&&(window.location=getRelativeRootPath()+"r/"+b+"/"+c)}
var toggleProjectSub=function(b,c){var a=$("#project-subscribe");a.addClass("disabled");a.prop("onclick",null).off("click");ajax("ci.project.togglesub",{data:{projectId:b,level:c},success:function(){window.location.reload(!0)}})};
